<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lethe">


    <meta name="subtitle" content="Life is a struggle">


    <meta name="description" content="Lethe's Blog">


    <meta name="keywords" content="Lethe's Blog">


<title>学一下Ajax | Lethe&#39;s Blog</title>



    <link rel="icon" href="https://s2.ax1x.com/2019/10/30/K5JenU.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/blog/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/blog/js/script.js"></script>
    
    <script src="/blog/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 6.1.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/blog/">Lethe&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/blog/archives">Posts</a>
                
                    <a class="menu-item" href="/blog/category">Categories</a>
                
                    <a class="menu-item" href="/blog/tag">Tags</a>
                
                    <a class="menu-item" href="/blog/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/blog/">Lethe&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/blog/archives">Posts</a>
                
                    <a class="menu-item" href="/blog/category">Categories</a>
                
                    <a class="menu-item" href="/blog/tag">Tags</a>
                
                    <a class="menu-item" href="/blog/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">学一下Ajax</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lethe</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 19, 2019&nbsp;&nbsp;20:14:26</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/blog/categories/Study-Notes/">Study Notes</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="0x01-Axaj简介"><a href="#0x01-Axaj简介" class="headerlink" title="0x01 Axaj简介"></a>0x01 Axaj简介</h2><h6 id="（1）概述"><a href="#（1）概述" class="headerlink" title="（1）概述"></a>（1）概述</h6><p>AJAX &#x3D; 异步 JavaScript 和 XML。</p>
<p>AJAX 是一种用于创建快速动态网页的技术。</p>
<p>通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<h6 id="（2）Ajax的执行过程"><a href="#（2）Ajax的执行过程" class="headerlink" title="（2）Ajax的执行过程"></a>（2）Ajax的执行过程</h6><p>使用Ajax技术通常包括以下几个步骤：</p>
<ul>
<li>创建一个Ajax对象。</li>
<li>在此对象的基础上根据HTTP协议的规范向服务器发送HTTP请求。</li>
<li>服务器接收到Ajax请求后会响应此请求，并根据事先约定的格式返回相应的数据集。</li>
<li>浏览器接收到服务器的响应，获取返回数据集，更新部分网页内容。</li>
</ul>
<p>用一句话概括，即Ajax通过XMLHttpRequest对象向服务器发出HTTP请求，当获取到服务器返回的数据后进行相应的页面数据的渲染处理。</p>
<br>

<h2 id="0x02-XHR对象创建"><a href="#0x02-XHR对象创建" class="headerlink" title="0x02 XHR对象创建"></a>0x02 XHR对象创建</h2><p>Ajax的核心是XMLHttpRequest对象（简称为XHR对象）的使用，XMLHttpRequest对象作为浏览器请求服务器的一个接口，可以使用异步的方式通过浏览器向服务器发送请求并解析服务器的响应。</p>
<p>使用Ajax服务器发送HTTP请求的首要任务是创建一个XMLHttpRequest对象，也称实例化XHR对象，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="0x03-Ajax发送请求"><a href="#0x03-Ajax发送请求" class="headerlink" title="0x03 Ajax发送请求"></a>0x03 Ajax发送请求</h2><h6 id="（1）open-方法"><a href="#（1）open-方法" class="headerlink" title="（1）open() 方法"></a>（1）open() 方法</h6><p>用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(method,url,async)</span><br></pre></td></tr></table></figure>

<p>规定请求的类型、URL 以及是否异步处理请求。</p>
<ul>
<li>method：请求的类型；GET 或 POST</li>
<li>url：文件在服务器上的位置</li>
<li>async：true（异步）或 false（同步）</li>
</ul>
<p>demo:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">	xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;./Ajax/demo_get.php&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h6 id="（2）send-方法"><a href="#（2）send-方法" class="headerlink" title="（2）send() 方法"></a>（2）send() 方法</h6><p>用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send(string)</span><br></pre></td></tr></table></figure>

<p>open()方法执行完毕后，调用send()方法通过HTTP协议将请求发送到服务器。</p>
<p>如果为GET请求，send()方法无参数，默认为<code>null</code>；如果为POST请求，则send()方法的参数为要发送的数据。</p>
<p>demo:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">	xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;./Ajax/demo_get.php&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">	xhr.<span class="title function_">sned</span>(<span class="literal">null</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="0x04-Ajax接收响应"><a href="#0x04-Ajax接收响应" class="headerlink" title="0x04 Ajax接收响应"></a>0x04 Ajax接收响应</h2><p>浏览器接收到服务器的响应后，信息可以通过XMLHttpRequest对象的属性和方法使用。在使用XHR对象接收响应的过程中有四个常用的属性，分别为：</p>
<ul>
<li><code>status</code>：以数字形式返回HTTP响应的状态码。</li>
<li><code>responseText</code>：以文本形式作为响应主体被返回。</li>
<li><code>responseXML</code>：如果响应的内容类型。是”text&#x2F;xml”或”application&#x2F;xml”，那么此属性将以document形式返回保存响应数据的XML DOM文档。</li>
<li><code>statusText</code>：以文本形式返回HTTP的状态说明。</li>
</ul>
<p>demo:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">	xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;./Ajax/demo_get.php&quot;</span>, <span class="literal">false</span>);	<span class="comment">//同步请求</span></span><br><span class="line">	xhr.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">	<span class="comment">//判断请求是否成功</span></span><br><span class="line">	<span class="keyword">if</span>(xhr.<span class="property">status</span> == <span class="number">200</span> || xhr.<span class="property">status</span> == <span class="number">304</span>)&#123;</span><br><span class="line">		<span class="title function_">alert</span>(xhr.<span class="property">responseText</span>);	<span class="comment">//打印响应数据</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_">alert</span>(<span class="string">&quot;请求失败，状态码为：&quot;</span> + xhr.<span class="property">status</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>


<br>

<h2 id="0x05-异步Ajax"><a href="#0x05-异步Ajax" class="headerlink" title="0x05 异步Ajax"></a>0x05 异步Ajax</h2><p>如果设置open()方法的第三个参数值为true，则表示Ajax需要异步处理请求。此时，需要判断服务器响应的数据是否传送完成，检测XHR对象中的readState属性的状态码是否为4.</p>
<p>readySate属性表示请求&#x2F;响应过程当前的状态，如下表：</p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>状态</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>未初始化</td>
<td>尚未调用open方法</td>
</tr>
<tr>
<td>1</td>
<td>启动</td>
<td>已经调用open()，尚未调用send()</td>
</tr>
<tr>
<td>2</td>
<td>发送</td>
<td>已经调用send()，但尚未收到头信息</td>
</tr>
<tr>
<td>3</td>
<td>接收</td>
<td>已经接收到部分相应的主题信息</td>
</tr>
<tr>
<td>4</td>
<td>完成</td>
<td>已经接收到全部响应数据，且可以在客户端使用</td>
</tr>
</tbody></table>
<p>理论上，Ajax发送请求处理响应的过程中只要<code>readState</code>的状态码改变一次，就会触发<code>readystatechange</code>事件，因此可以利用这个事件来检测每次状态变化后readySate的值，来判断当前Ajax接收数据的状态。</p>
<p>demo:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">loadXMLDoc</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> xmlhttp;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">else</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#123;<span class="comment">// code for IE6, IE5</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  xmlhttp=<span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//创建onreadystatechange事件监测Ajax状态变化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span>==<span class="number">4</span> &amp;&amp; xmlhttp.<span class="property">status</span>==<span class="number">200</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myDiv&quot;</span>).<span class="property">innerHTML</span>=xmlhttp.<span class="property">responseText</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;/ajax/test1.txt&quot;</span>,<span class="literal">true</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">xmlhttp.<span class="title function_">send</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;myDiv&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Let AJAX change this text<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;loadXMLDoc()&quot;</span>&gt;</span>通过 AJAX 改变内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<br>

<h2 id="0x06-JSON数据传递"><a href="#0x06-JSON数据传递" class="headerlink" title="0x06 JSON数据传递"></a>0x06 JSON数据传递</h2><p>目前Ajax技术进行数据传递时，采用JSON格式的数据进行传递已经成为事实上的标准。相较与XML而言，使用JSON格式的数据传递实现简单且方便。采用JSON格式的数据进行传递时，往往应用于数据量比较多，且需要清晰传递的情况。但是此种方式传递需要将服务器返回的JSON格式字符串先转化为Javascript对象。</p>
<p>demo：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;info();&quot;</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;school&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">readyState</span> == <span class="number">4</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="keyword">var</span> person = <span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> + <span class="variable language_">this</span>.<span class="property">responseText</span> + <span class="string">&#x27;)&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;name&#x27;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;name:&quot;</span> + person.<span class="property">name</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;age&#x27;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;age:&quot;</span> + person.<span class="property">age</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;school&#x27;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;school:&quot;</span> + person.<span class="property">school</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;ajax_json.php&#x27;</span>, <span class="literal">true</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            xhr.<span class="title function_">send</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>说明：<code>eval()</code>方法可以将JSON字符串转换为JSON对象。</p>
<p>服务端的返回的JSON格式的数据，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$person</span> = [];</span><br><span class="line">    <span class="variable">$person</span>[] = <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Lethe&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;age&#x27;</span> =&gt; <span class="string">&#x27;19&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;school&#x27;</span> =&gt; <span class="string">&#x27;CUMT&#x27;</span>);</span><br><span class="line">    <span class="variable">$person</span>[] = <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;age&#x27;</span> =&gt; <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;school&#x27;</span> =&gt; <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">    <span class="variable">$person</span>[] = <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Ben&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;age&#x27;</span> =&gt; <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;school&#x27;</span> =&gt; <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">    <span class="variable">$n</span> = <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$person</span>[<span class="variable">$n</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/Learn-Ajax/20190920010126777.png" alt="在这里插入图片描述"></p>
<br>

<h2 id="0x06-查询缓存"><a href="#0x06-查询缓存" class="headerlink" title="0x06 查询缓存"></a>0x06 查询缓存</h2><p>为了避免缓存带来的影响，可以向URL中添加一个随机数或者时间戳作为请求数据的一部分，发送给服务器，以保证当前的请求始终为首次发送。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> username = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;username&quot;</span>)[<span class="number">0</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    username.<span class="property">onblur</span> = <span class="keyword">function</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> url = <span class="string">&quot;./Ajax/demo_get.php?username=&quot;</span> + <span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span>(xhr.<span class="property">status</span> == <span class="number">4</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125; </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>,url+<span class="string">&#x27;&amp;num&#x27;</span>+<span class="title class_">Math</span>.<span class="title function_">random</span>(), <span class="literal">true</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        xhr.<span class="title function_">sned</span>(<span class="literal">null</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="0x07-Ajax函数封装"><a href="#0x07-Ajax函数封装" class="headerlink" title="0x07 Ajax函数封装"></a>0x07 Ajax函数封装</h2><p>使用Ajax发送HTTP请求通常有如下几个步骤：</p>
<ul>
<li><p>实例化XMLHttpRequest对象</p>
</li>
<li><p>通过open()方法规定Ajax发送的请求类型、服务器URL地址，以及是否为异步处理请求。</p>
</li>
<li><p>通过send()方法发送使用open()方法定义好的Ajax请求，并根据XMLHttpRequest对象中规定的具体参数判断Ajax请求响应的状态，根据不同的状态进行不同的操作。</p>
</li>
</ul>
<p>使用Ajax的步骤基本固定，因此可以把上述步骤抽象出来封装成一个Ajax方法，当需要调用Ajax时，直接调用此方法即可，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    <span class="comment">// 创建XHR对象，并设置Ajax默认为GET请求方式，设置回调函数异步处理请求，返回响应</span></span><br><span class="line">    obj.<span class="property">method</span> = obj.<span class="property">method</span> || <span class="string">&#x27;get&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;    <span class="comment">//异步处理请求，接收响应</span></span><br><span class="line">        <span class="keyword">if</span>((xhr.<span class="property">status</span> == <span class="number">4</span>)&amp;&amp;(xhr.<span class="property">status</span> == <span class="number">200</span>))&#123;</span><br><span class="line">            <span class="comment">//callback()为回调函数，若不设置则无回调</span></span><br><span class="line">            obj.<span class="property">callback</span> &amp;&amp; obj.<span class="title function_">callback</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//分别用GET和POST两种方式创建查询字符串，用来保护用户提交的数据信息，并分别发送Ajax异步请求</span></span><br><span class="line">    <span class="keyword">var</span> strData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(obj.<span class="property">method</span> == <span class="string">&#x27;post&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj.<span class="property">data</span>)&#123;</span><br><span class="line">            strData += <span class="string">&#x27;&amp;&#x27;</span> + key + <span class="string">&#x27;=&#x27;</span> + obj.<span class="property">data</span>[key];</span><br><span class="line">        &#125;</span><br><span class="line">        strData = strData.<span class="title function_">substring</span>(<span class="number">1</span>); <span class="comment">//去掉开头多余的&amp;</span></span><br><span class="line">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, obj.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//设置请求头</span></span><br><span class="line">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencode&quot;</span>);</span><br><span class="line">        xhr.<span class="title function_">send</span>(strData);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//如果是GET方式，则需要对数据进行编码</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj.<span class="property">data</span>)&#123;</span><br><span class="line">            strData += <span class="string">&#x27;&amp;&#x27;</span> + <span class="built_in">encodeURIComponent</span>(key) + <span class="string">&#x27;=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(obj.<span class="property">data</span>[key]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//去掉多余的&amp;,并增加时间戳，防止缓存</span></span><br><span class="line">        strData = strData.<span class="title function_">substring</span>(<span class="number">1</span>) + <span class="string">&#x27;&amp;&#x27;</span> + <span class="title class_">Number</span>(<span class="keyword">new</span> <span class="title class_">Data</span>());</span><br><span class="line">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, obj.<span class="property">url</span> + <span class="string">&#x27;?&#x27;</span> + strData, <span class="literal">true</span>);</span><br><span class="line">        xhr.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>调用事例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">html code...</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">btn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    ajax(&#123;</span></span><br><span class="line"><span class="params">        url: <span class="string">&#x27;/ajax/demo.php&#x27;</span>,</span></span><br><span class="line"><span class="params">        method: <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="params">        data: &#123;year:year.value, month:month.value, day:dat.value&#125;,</span></span><br><span class="line"><span class="params">        callback: <span class="keyword">function</span>(data)&#123;</span></span><br><span class="line"><span class="params">            result.innerHTML = data;</span></span><br><span class="line"><span class="params">        &#125;</span></span><br><span class="line"><span class="params">    &#125;)</span></span><br><span class="line"><span class="params">&#125;</span>)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lethe</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://lethe.site/blog/2019/09/19/Learn-Ajax/">https://lethe.site/blog/2019/09/19/Learn-Ajax/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2022 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/blog/tags/JavaScript/"># JavaScript</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/blog/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/blog/2019/10/20/Data-structure-experiment-review/">数据结构实验复习</a>
            
            
            <a class="next" rel="next" href="/blog/2019/09/11/ByteCTF-2019-XNUCA-2019-Web/">ByteCTF_2019&XNUCA_2019部分web题复现</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Life is a struggle.</span>
        <!-- <span>© Lethe | 2019 - 2022</span> -->
    </div>
</footer>

    </div>
</body>

</html>